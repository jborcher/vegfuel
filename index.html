<!DOCTYPE html>
<!-- saved from url=(0058)file:///C:/Users/jerem/Downloads/vegfuel-sage-index_1.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>VegFuel â€” Nutrition for Athletes</title>
<meta name="theme-color" content="#d4e6d4">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="VegFuel">
<meta name="description" content="Plant-powered nutrition tracker for athletes">
<link rel="manifest" href="/vegfuel/manifest.json">
<link rel="icon" href="file:///C:/Users/jerem/Downloads/icon-192.png">
<link rel="apple-touch-icon" href="file:///C:/Users/jerem/Downloads/icon-192.png">
<link href="./index_files/css2" rel="stylesheet">
<style>
  :root {
    --bg: #d4e6d4;
    --card: #e4f0e4;
    --card2: #d0e5d0;
    --green: #2d8c4e;
    --lime: #5aab2e;
    --orange: #d4622a;
    --blue: #2e6fa8;
    --purple: #7c4daa;
    --text: #1a2e1b;
    --muted: #6b8f6c;
    --border: #c5dbc5;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    padding: 0 0 max(60px, calc(60px + env(safe-area-inset-bottom)));
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
    -webkit-text-size-adjust: 100%;
  }
  /* Prevent tap highlight flash on mobile */
  button, .preset-chip { -webkit-tap-highlight-color: transparent; }
  /* Grain overlay */
  body::before {
    content:''; position:fixed; inset:0; pointer-events:none; z-index:999;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.05'/%3E%3C/svg%3E");
    opacity: 0.12;
  }

  header {
    padding: 20px 20px 16px;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: baseline; gap: 12px; flex-wrap: wrap;
    animation: fadeDown 0.6s ease both;
  }
  header h1 {
    font-family: 'Syne', sans-serif;
    font-size: 2.4rem; font-weight: 800; letter-spacing: -1px;
    color: var(--green);
  }
  header span { color: var(--muted); font-size: 0.75rem; }
  @media (min-width: 600px) {
    header { padding: 32px 40px 20px; }
    header h1 { font-size: 3rem; }
  }

  .container { max-width: 1100px; margin: 0 auto; padding: 20px 14px; }
  @media (min-width: 600px) { .container { padding: 36px 24px; } }

  .layout { display: grid; grid-template-columns: 1fr 1fr; gap: 28px; }
  @media (max-width: 800px) { .layout { grid-template-columns: 1fr; } }
  /* Goals panel sits between the two panels, spanning full width */
  .layout > .goals-panel { grid-column: 1 / -1; }

  .panel {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 18px 16px;
    animation: fadeUp 0.5s ease both;
  }
  @media (min-width: 600px) { .panel { padding: 28px; } }
  .panel:nth-child(2) { animation-delay: 0.1s; }

  .panel-title {
    font-family: 'Syne', sans-serif;
    font-size: 0.75rem; font-weight: 700;
    letter-spacing: 3px; text-transform: uppercase;
    color: var(--muted); margin-bottom: 20px;
  }

  /* Search input */
  .search-row {
    display: grid;
    grid-template-columns: 1fr 72px auto;
    grid-template-rows: auto auto;
    gap: 8px;
    margin-bottom: 14px;
  }
  .search-row input[type="text"] {
    grid-column: 1 / 2;
  }
  .search-row input[type="number"] {
    grid-column: 2 / 3;
    width: 100%;
  }
  .search-row select {
    grid-column: 3 / 4;
    grid-row: 1 / 2;
  }
  .search-row .btn {
    grid-column: 1 / -1;
    grid-row: 2 / 3;
    width: 100%;
  }
  @media (min-width: 600px) {
    .search-row {
      display: flex; gap: 10px;
    }
    .search-row .btn { width: auto; }
  }
  input[type="text"], input[type="number"], select {
    background: var(--card2);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 1rem; /* prevents iOS zoom on focus */
    padding: 12px 14px;
    border-radius: 8px;
    outline: none;
    transition: border-color 0.2s;
  }
  input:focus, select:focus { border-color: var(--green); }
  input[type="text"] { flex: 1; }
  input[type="number"] { width: 72px; }
  select { flex: 1; min-width: 80px; }

  .btn {
    background: var(--green); color: #0e1a0f;
    font-family: 'Syne', sans-serif; font-weight: 700;
    font-size: 0.85rem; letter-spacing: 1px;
    padding: 12px 18px; border: none;
    border-radius: 8px; cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    white-space: nowrap;
    min-height: 44px; /* touch target */
    touch-action: manipulation;
  }
  .btn:hover { background: var(--lime); }
  .btn:active { transform: scale(0.97); }
  .btn-ghost {
    background: transparent; color: var(--green);
    border: 1px solid var(--border);
  }
  .btn-ghost:hover { background: var(--card2); color: var(--lime); }

  /* Preset list */
  .preset-grid {
    display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px;
  }
  .preset-chip {
    background: var(--card2); border: 1px solid var(--border);
    color: var(--text); font-family: 'DM Mono', monospace;
    font-size: 0.78rem; padding: 8px 14px; border-radius: 999px;
    cursor: pointer; transition: all 0.15s;
    min-height: 36px; display: inline-flex; align-items: center;
    touch-action: manipulation;
  }
  .preset-chip:hover { border-color: var(--green); color: var(--green); }
  .preset-chip.selected { background: var(--green); color: #0e1a0f; border-color: var(--green); }

  /* Ingredient list */
  .ingredient-list { list-style: none; display: flex; flex-direction: column; gap: 8px; }
  .ingredient-item {
    display: flex; align-items: center; justify-content: space-between;
    background: var(--card2); border: 1px solid var(--border);
    border-radius: 8px; padding: 10px 14px;
    animation: fadeIn 0.25s ease;
  }
  .ingredient-item span { font-size: 0.82rem; }
  .ingredient-item .amount { color: var(--lime); margin-left: 6px; }
  .remove-btn {
    background: none; border: none; color: var(--muted);
    cursor: pointer; font-size: 1rem; line-height: 1;
    transition: color 0.15s;
    min-width: 36px; min-height: 36px;
    display: flex; align-items: center; justify-content: center;
    touch-action: manipulation;
  }
  .remove-btn:hover { color: #f87171; }

  /* Results panel */
  .results-panel {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 18px 16px;
    margin-top: 20px;
    animation: fadeUp 0.5s ease both;
    animation-delay: 0.2s;
  }
  @media (min-width: 600px) { .results-panel { padding: 28px; margin-top: 28px; } }

  .meal-name-row { display: flex; gap: 10px; margin-bottom: 24px; }
  .meal-name-row input { flex: 1; font-size: 1rem; padding: 12px 16px; }

  .macro-grid {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px;
    margin-bottom: 28px;
  }
  @media (max-width: 600px) { .macro-grid { grid-template-columns: repeat(2,1fr); } }

  .macro-card {
    background: var(--card2);
    border: 1px solid var(--border);
    border-radius: 12px; padding: 16px 14px;
    text-align: center;
    transition: transform 0.2s;
  }
  .macro-card:hover { transform: translateY(-2px); }
  .macro-card .val {
    font-family: 'Nunito', sans-serif;
    font-size: 1.8rem; font-weight: 900;
    line-height: 1; margin-bottom: 4px;
  }
  .macro-card .lbl { font-size: 0.68rem; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; font-family: 'Nunito', sans-serif; font-weight: 700; }

  .micro-grid {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
    margin-bottom: 28px;
  }
  @media (max-width: 600px) { .micro-grid { grid-template-columns: repeat(2,1fr); } }

  .micro-card {
    background: var(--card2); border: 1px solid var(--border);
    border-radius: 10px; padding: 12px;
  }
  .micro-card .micro-lbl { font-size: 0.68rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 6px; }
  .micro-card .micro-bar-wrap { background: var(--border); border-radius: 4px; height: 6px; margin-bottom: 4px; overflow: hidden; }
  .micro-card .micro-bar { height: 100%; border-radius: 4px; transition: width 0.6s cubic-bezier(.4,0,.2,1); }
  .micro-card .micro-val { font-size: 0.75rem; color: var(--text); }

  .athlete-tip {
    background: linear-gradient(135deg, #ddeedd, #cfe8cf);
    border: 1px solid #b0cfb0;
    border-left: 3px solid var(--green);
    border-radius: 10px; padding: 14px 18px;
    font-size: 0.8rem; color: #2e5230; line-height: 1.6;
  }
  .athlete-tip strong { color: var(--green); font-family: 'Syne', sans-serif; }

  .empty-state {
    text-align: center; padding: 40px 20px;
    color: var(--muted); font-size: 0.82rem; line-height: 1.8;
  }
  .empty-state .icon { font-size: 7.5rem; margin-bottom: 10px; }

  .section-label {
    font-size: 0.68rem; letter-spacing: 2px; text-transform: uppercase;
    color: var(--muted); margin-bottom: 12px;
    font-family: 'Syne', sans-serif; font-weight: 700;
  }

  .divider { border: none; border-top: 1px solid var(--border); margin: 20px 0; }

  /* â”€â”€ Goals Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .goals-panel {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    margin-top: 20px;
    overflow: hidden;
    animation: fadeUp 0.5s ease both;
    animation-delay: 0.15s;
  }
  @media (min-width: 600px) { .goals-panel { margin-top: 28px; } }

  .goals-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 16px;
    cursor: pointer;
    user-select: none;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  @media (min-width: 600px) { .goals-header { padding: 20px 28px; } }

  .goals-header-left { display: flex; align-items: center; gap: 10px; }
  .goals-toggle-icon {
    font-size: 0.85rem; color: var(--muted);
    transition: transform 0.3s ease;
    display: inline-block;
  }
  .goals-toggle-icon.open { transform: rotate(180deg); }

  .goals-body {
    padding: 0 16px 20px;
    display: none;
  }
  .goals-body.open { display: block; }
  @media (min-width: 600px) { .goals-body { padding: 0 28px 24px; } }

  /* â”€â”€ Weight + unit toggle â”€â”€ */
  .goals-setup-row {
    display: flex; flex-wrap: wrap; gap: 14px; align-items: flex-end;
    margin-bottom: 20px;
  }
  .weight-field { display: flex; flex-direction: column; gap: 5px; }
  .weight-field label {
    font-size: 0.65rem; letter-spacing: 2px; text-transform: uppercase;
    color: var(--muted); font-family: 'Syne', sans-serif; font-weight: 700;
  }
  .weight-input-row { display: flex; gap: 6px; align-items: center; }
  .weight-input-row input { width: 80px; text-align: center; }
  .weight-unit-toggle {
    display: flex; border: 1px solid var(--border); border-radius: 8px; overflow: hidden;
  }
  .weight-unit-toggle button {
    background: var(--card2); color: var(--muted);
    border: none; padding: 10px 12px; font-family: 'DM Mono', monospace;
    font-size: 0.78rem; cursor: pointer; transition: all 0.15s;
    min-height: 44px; touch-action: manipulation;
  }
  .weight-unit-toggle button.active { background: var(--green); color: #0e1a0f; }

  /* â”€â”€ Day type cards â”€â”€ */
  .day-type-row {
    display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;
  }
  .day-type-card {
    flex: 1; min-width: 130px;
    background: var(--card2); border: 2px solid var(--border);
    border-radius: 12px; padding: 14px 10px;
    cursor: pointer; transition: all 0.2s;
    touch-action: manipulation; -webkit-tap-highlight-color: transparent;
    text-align: center;
  }
  .day-type-card:hover { border-color: var(--green); }
  .day-type-card.selected { border-color: var(--green); background: #d6eedd; }
  .day-type-card .day-icon { font-size: 1.4rem; margin-bottom: 5px; }
  .day-type-card .day-label {
    font-family: 'Syne', sans-serif; font-weight: 700;
    font-size: 0.75rem; color: var(--text); letter-spacing: 0.5px;
    margin-bottom: 3px;
  }
  .day-type-card .day-desc {
    font-size: 0.65rem; color: var(--muted); line-height: 1.4;
  }
  .day-type-card.selected .day-label { color: var(--green); }

  .goals-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 8px;
  }
  @media (min-width: 500px) { .goals-grid { grid-template-columns: repeat(4, 1fr); } }

  .goal-field { display: flex; flex-direction: column; gap: 5px; }
  .goal-field label {
    font-size: 0.65rem; letter-spacing: 2px; text-transform: uppercase;
    color: var(--muted); font-family: 'Syne', sans-serif; font-weight: 700;
  }
  .goal-field input {
    width: 100%; font-size: 1rem; padding: 10px 10px;
    text-align: center;
  }
  .goal-unit {
    font-size: 0.65rem; color: var(--muted); text-align: center; margin-top: 2px;
  }
  .goals-formula-note {
    font-size: 0.7rem; color: var(--muted); line-height: 1.6;
    margin-top: 10px; font-style: italic;
  }

  .goals-presets {
    display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 14px;
  }

  /* â”€â”€ Macro card goal bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .macro-card .goal-bar-wrap {
    background: var(--border); border-radius: 4px; height: 5px;
    margin: 8px 0 4px; overflow: hidden;
  }
  .macro-card .goal-bar {
    height: 100%; border-radius: 4px;
    transition: width 0.6s cubic-bezier(.4,0,.2,1);
  }
  .macro-card .goal-pct {
    font-size: 0.65rem; color: var(--muted);
    font-family: 'Nunito', sans-serif; font-weight: 700;
  }
  .macro-card.over .goal-bar { background: #f87171 !important; }
  .macro-card.over .goal-pct { color: #f87171; }

  /* â”€â”€ Custom ingredient form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .custom-ing-toggle {
    display: flex; align-items: center; gap: 8px;
    cursor: pointer; user-select: none;
    margin-top: 18px; padding-top: 16px;
    border-top: 1px solid var(--border);
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }
  .custom-ing-toggle .section-label { margin: 0; }
  .custom-ing-toggle-icon {
    font-size: 0.75rem; color: var(--muted);
    transition: transform 0.25s; display: inline-block; margin-left: auto;
  }
  .custom-ing-toggle-icon.open { transform: rotate(180deg); }

  .custom-ing-form { display: none; margin-top: 14px; }
  .custom-ing-form.open { display: block; }

  .cif-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 10px;
  }
  @media (min-width: 500px) { .cif-grid { grid-template-columns: repeat(4, 1fr); } }

  .cif-field { display: flex; flex-direction: column; gap: 4px; }
  .cif-field label {
    font-size: 0.62rem; letter-spacing: 1.5px; text-transform: uppercase;
    color: var(--muted); font-family: 'Syne', sans-serif; font-weight: 700;
  }
  .cif-field input {
    width: 100%; font-size: 0.9rem; padding: 8px 10px; text-align: center;
  }
  .cif-name { margin-bottom: 10px; }
  .cif-name input { width: 100%; font-size: 1rem; }
  .cif-section-label {
    font-size: 0.62rem; letter-spacing: 2px; text-transform: uppercase;
    color: var(--muted); font-family: 'Syne', sans-serif; font-weight: 700;
    margin: 12px 0 8px;
  }
  .cif-note {
    font-size: 0.68rem; color: var(--muted); margin-bottom: 12px; line-height: 1.5;
  }
  .cif-actions { display: flex; gap: 8px; margin-top: 4px; }
  .cif-actions .btn { flex: 1; }

  .saved-customs { margin-top: 14px; }
  .saved-custom-item {
    display: flex; align-items: center; justify-content: space-between;
    background: var(--card2); border: 1px solid var(--border);
    border-radius: 8px; padding: 8px 12px; margin-bottom: 6px;
    font-size: 0.78rem;
  }
  .saved-custom-item .sci-name { font-weight: 600; color: var(--text); }
  .saved-custom-item .sci-macros { font-size: 0.68rem; color: var(--muted); margin-top: 1px; }
  .saved-custom-item .sci-actions { display: flex; gap: 4px; flex-shrink: 0; }
  .sci-btn {
    background: none; border: 1px solid var(--border); border-radius: 6px;
    color: var(--muted); font-family: 'DM Mono', monospace; font-size: 0.7rem;
    padding: 4px 8px; cursor: pointer; transition: all 0.15s;
    min-height: 30px; touch-action: manipulation;
  }
  .sci-btn:hover { border-color: var(--green); color: var(--green); }
  .sci-btn.del:hover { border-color: #f87171; color: #f87171; }

  /* â”€â”€ Mixtures panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .mixtures-panel {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 16px; margin-top: 20px; overflow: hidden;
    animation: fadeUp 0.5s ease both; animation-delay: 0.18s;
  }
  @media (min-width: 600px) { .mixtures-panel { margin-top: 28px; } }
  .mixtures-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px; cursor: pointer; user-select: none;
    touch-action: manipulation; -webkit-tap-highlight-color: transparent;
  }
  @media (min-width: 600px) { .mixtures-header { padding: 20px 28px; } }
  .mixtures-body { padding: 0 16px 20px; display: none; }
  .mixtures-body.open { display: block; }
  @media (min-width: 600px) { .mixtures-body { padding: 0 28px 28px; } }

  .mixture-card {
    background: var(--card2); border: 1px solid var(--border);
    border-radius: 10px; padding: 12px 14px; margin-bottom: 10px;
  }
  .mixture-card-header { display: flex; align-items: flex-start; justify-content: space-between; gap: 8px; }
  .mixture-card-name { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.9rem; color: var(--text); }
  .mixture-card-meta { font-size: 0.68rem; color: var(--muted); margin-top: 3px; }
  .mixture-card-macros { font-size: 0.72rem; color: var(--text); margin-top: 8px; display: flex; flex-wrap: wrap; gap: 6px; }
  .mixture-macro-chip { background: var(--card); border: 1px solid var(--border); border-radius: 6px; padding: 3px 8px; font-size: 0.68rem; }
  .mixture-card-actions { display: flex; gap: 6px; margin-top: 10px; align-items: center; flex-wrap: wrap; }
  .mixture-add-row { display: flex; gap: 6px; flex: 1; min-width: 160px; }
  .mixture-add-row input { width: 70px; font-size: 0.9rem; padding: 7px 8px; text-align: center; }
  .mixture-add-row select { font-size: 0.9rem; padding: 7px 8px; }
  .mix-btn {
    background: var(--green); color: #0e1a0f;
    font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.75rem;
    padding: 7px 12px; border: none; border-radius: 7px; cursor: pointer;
    transition: background 0.15s; white-space: nowrap; min-height: 36px; touch-action: manipulation;
  }
  .mix-btn:hover { background: var(--lime); }
  .mix-btn.ghost { background: transparent; color: var(--muted); border: 1px solid var(--border); font-size: 0.72rem; }
  .mix-btn.ghost:hover { color: #f87171; border-color: #f87171; }
  .mix-btn.edit-btn { background: transparent; color: var(--green); border: 1px solid var(--border); font-size: 0.72rem; }
  .mix-btn.edit-btn:hover { background: var(--card); }

  .mixture-builder {
    background: var(--card2); border: 1px solid var(--green);
    border-radius: 12px; padding: 16px; margin-bottom: 16px;
  }
  .mixture-builder-title {
    font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.8rem;
    color: var(--green); margin-bottom: 14px; letter-spacing: 1px; text-transform: uppercase;
  }
  .mix-search-row { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
  .mix-search-row input[type="text"] { flex: 1; min-width: 140px; font-size: 1rem; padding: 10px 12px; }
  .mix-search-row input[type="number"] { width: 70px; font-size: 1rem; padding: 10px 8px; }
  .mix-search-row select { font-size: 1rem; padding: 10px 8px; }
  .mix-ing-list { list-style: none; display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px; }
  .mix-ing-item {
    display: flex; align-items: center; justify-content: space-between;
    background: var(--card); border: 1px solid var(--border);
    border-radius: 7px; padding: 8px 12px; font-size: 0.8rem; animation: fadeIn 0.2s ease;
  }
  .mix-ing-item .amount { color: var(--lime); margin-left: 5px; }
  .mix-yield-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
  .mix-yield-row label {
    font-size: 0.68rem; letter-spacing: 1.5px; text-transform: uppercase;
    color: var(--muted); font-family: 'Syne', sans-serif; font-weight: 700; white-space: nowrap;
  }
  .mix-yield-row input { width: 90px; font-size: 1rem; padding: 9px 10px; }
  .mix-yield-note { font-size: 0.68rem; color: var(--muted); }
  .mix-preview {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 8px; padding: 10px 14px; margin-bottom: 12px;
  }
  .mix-preview-title {
    font-size: 0.65rem; letter-spacing: 2px; text-transform: uppercase;
    color: var(--muted); font-family: 'Syne', sans-serif; font-weight: 700; margin-bottom: 8px;
  }
  .mix-preview-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
  @media (max-width: 500px) { .mix-preview-grid { grid-template-columns: repeat(2,1fr); } }
  .mix-preview-cell { text-align: center; }
  .mix-preview-val { font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 1.1rem; }
  .mix-preview-lbl { font-size: 0.6rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
  .mix-name-row { margin-bottom: 12px; }
  .mix-name-row input { width: 100%; font-size: 1rem; padding: 10px 12px; }

  .mixtures-quickadd { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }

  @keyframes fadeUp { from { opacity:0; transform: translateY(16px); } to { opacity:1; transform: none; } }
  @keyframes fadeDown { from { opacity:0; transform: translateY(-10px); } to { opacity:1; transform: none; } }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
</style>
</head>
<body>

<header>
  <h1>ðŸ¥¦ VegFuel</h1>
  <span>nutrition tracker for plant-powered athletes</span>
</header>

<div class="container">
  <div class="layout">

    <!-- LEFT: Input Panel -->
    <div class="panel">
      <div class="panel-title">Add Ingredients</div>

      <!-- Type input -->
      <div class="section-label">Type an ingredient</div>
      <div class="search-row">
        <input type="text" id="customInput" placeholder="e.g. tofu, quinoa, spinach..." list="ingredientSuggestions" onkeydown="if(event.key===&#39;Enter&#39;) addCustomIngredient()">
        <datalist id="ingredientSuggestions"><option value="tofu"></option><option value="tempeh"></option><option value="edamame"></option><option value="lentils"></option><option value="green lentils"></option><option value="chickpeas"></option><option value="black beans"></option><option value="greek yogurt"></option><option value="cottage cheese"></option><option value="eggs"></option><option value="chicken breast"></option><option value="ground turkey"></option><option value="turkey breast"></option><option value="salmon"></option><option value="tuna"></option><option value="canned tuna"></option><option value="shrimp"></option><option value="tilapia"></option><option value="cod"></option><option value="sardines"></option><option value="beef sirloin"></option><option value="ground beef"></option><option value="lean ground beef"></option><option value="pork tenderloin"></option><option value="whey protein powder"></option><option value="casein protein powder"></option><option value="quinoa"></option><option value="brown rice"></option><option value="oats"></option><option value="whole wheat bread"></option><option value="barley"></option><option value="spinach"></option><option value="kale"></option><option value="broccoli"></option><option value="sweet potato"></option><option value="avocado"></option><option value="carrot"></option><option value="celery"></option><option value="cucumber"></option><option value="tomato"></option><option value="bell pepper"></option><option value="red bell pepper"></option><option value="onion"></option><option value="garlic"></option><option value="mushrooms"></option><option value="zucchini"></option><option value="cauliflower"></option><option value="brussels sprouts"></option><option value="green beans"></option><option value="peas"></option><option value="corn"></option><option value="potato"></option><option value="beet"></option><option value="asparagus"></option><option value="cabbage"></option><option value="bok choy"></option><option value="arugula"></option><option value="swiss chard"></option><option value="collard greens"></option><option value="eggplant"></option><option value="leek"></option><option value="butternut squash"></option><option value="acorn squash"></option><option value="artichoke"></option><option value="turnip"></option><option value="radish"></option><option value="banana"></option><option value="apple"></option><option value="orange"></option><option value="blueberries"></option><option value="strawberries"></option><option value="mango"></option><option value="pineapple"></option><option value="grapes"></option><option value="watermelon"></option><option value="peach"></option><option value="pear"></option><option value="kiwi"></option><option value="lemon"></option><option value="cherries"></option><option value="raspberries"></option><option value="blackberries"></option><option value="raisins"></option><option value="dates"></option><option value="medjool dates"></option><option value="dried apricots"></option><option value="dried cranberries"></option><option value="dried mango"></option><option value="dried figs"></option><option value="prunes"></option><option value="dried blueberries"></option><option value="dried cherries"></option><option value="dried goji berries"></option><option value="dried pineapple"></option><option value="sultanas"></option><option value="pomegranate"></option><option value="papaya"></option><option value="walnuts"></option><option value="cashews"></option><option value="pistachios"></option><option value="pecans"></option><option value="macadamia nuts"></option><option value="brazil nuts"></option><option value="hazelnuts"></option><option value="pine nuts"></option><option value="peanuts"></option><option value="sunflower seeds"></option><option value="sesame seeds"></option><option value="flaxseeds"></option><option value="tahini"></option><option value="almond butter"></option><option value="cashew butter"></option><option value="mixed nuts"></option><option value="almonds"></option><option value="chia seeds"></option><option value="hemp seeds"></option><option value="pumpkin seeds"></option><option value="peanut butter"></option><option value="soy milk"></option><option value="oat milk"></option><option value="nutritional yeast"></option><option value="hulled hemp seeds"></option><option value="flaxseed meal"></option><option value="flax seed meal"></option><option value="chai seeds"></option><option value="cinnamon powder"></option><option value="unsweetened coconut"></option><option value="oat honey granola"></option><option value="tj cashew yogurt"></option><option value="cashew yogurt"></option><option value="forbidden rice sourdough"></option><option value="wfm forbidden rice sourdough"></option><option value="meyenberg vanilla goat yogurt"></option><option value="vanilla goat yogurt"></option><option value="oatly 4 ingredient"></option><option value="oatly 4 ingredient oat milk"></option><option value="tuscan kale"></option><option value="lacinato kale"></option><option value="raw tuscan kale"></option><option value="raw green beans"></option><option value="beets"></option><option value="red cabbage"></option><option value="green cabbage"></option><option value="wfm organic hummus"></option><option value="365 organic hummus"></option><option value="hummus"></option></datalist>
        <input type="number" id="customAmount" placeholder="100" value="100" min="0.1" step="0.1" onkeydown="if(event.key===&#39;Enter&#39;) addCustomIngredient()">
        <select id="customUnit">
          <option value="g">g</option>
          <option value="oz">oz (wt)</option>
          <option value="floz">fl oz</option>
          <option value="tsp">tsp</option>
          <option value="tbsp">tbsp</option>
          <option value="cup">cup</option>
        </select>
        <button class="btn" onclick="addCustomIngredient()">Add</button>
      </div>

      <div id="recentSection" style="display:none; margin-top:16px">
        <div class="section-label">Recently used</div>
        <div class="preset-grid" id="recentChips"></div>
      </div>

      <!-- Custom ingredient entry -->
      <div class="custom-ing-toggle" onclick="toggleCustomForm()">
        <div class="section-label">Create custom ingredient</div>
        <span class="custom-ing-toggle-icon" id="cifToggleIcon">â–¼</span>
      </div>
      <div class="custom-ing-form" id="cifForm">
        <div class="cif-note">Values are per 100g / 100ml. Only name and calories are required â€” leave others blank if unknown.</div>

        <div class="cif-name">
          <label style="font-size:0.62rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);font-family:'Syne',sans-serif;font-weight:700;display:block;margin-bottom:4px">Ingredient name</label>
          <input type="text" id="cifName" placeholder="e.g. my protein bar">
        </div>

        <div class="cif-section-label">Macros (per 100g)</div>
        <div class="cif-grid">
          <div class="cif-field"><label>Calories</label><input type="number" id="cifCal" placeholder="0" min="0" step="0.1"></div>
          <div class="cif-field"><label>Protein (g)</label><input type="number" id="cifProtein" placeholder="0" min="0" step="0.1"></div>
          <div class="cif-field"><label>Carbs (g)</label><input type="number" id="cifCarbs" placeholder="0" min="0" step="0.1"></div>
          <div class="cif-field"><label>Fat (g)</label><input type="number" id="cifFat" placeholder="0" min="0" step="0.1"></div>
          <div class="cif-field"><label>Fiber (g)</label><input type="number" id="cifFiber" placeholder="0" min="0" step="0.1"></div>
        </div>

        <div class="cif-section-label">Micros (per 100g)</div>
        <div class="cif-grid">
          <div class="cif-field"><label>Iron (mg)</label><input type="number" id="cifIron" placeholder="0" min="0" step="0.01"></div>
          <div class="cif-field"><label>Calcium (mg)</label><input type="number" id="cifCalcium" placeholder="0" min="0" step="0.1"></div>
          <div class="cif-field"><label>Potassium (mg)</label><input type="number" id="cifPotassium" placeholder="0" min="0" step="0.1"></div>
          <div class="cif-field"><label>Vitamin C (mg)</label><input type="number" id="cifVitC" placeholder="0" min="0" step="0.1"></div>
          <div class="cif-field"><label>Vitamin B12 (Âµg)</label><input type="number" id="cifVitB12" placeholder="0" min="0" step="0.01"></div>
          <div class="cif-field"><label>Zinc (mg)</label><input type="number" id="cifZinc" placeholder="0" min="0" step="0.01"></div>
          <div class="cif-field"><label>Magnesium (mg)</label><input type="number" id="cifMagnesium" placeholder="0" min="0" step="0.1"></div>
        </div>

        <div class="cif-actions">
          <button class="btn btn-ghost" onclick="clearCifForm()">Clear</button>
          <button class="btn" onclick="saveCustomIngredient()">Save &amp; Add to Log</button>
        </div>

        <!-- Saved custom ingredients -->
        <div class="saved-customs" id="savedCustomsSection" style="display:none">
          <div class="cif-section-label" style="margin-top:18px;padding-top:14px;border-top:1px solid var(--border)">Saved custom ingredients</div>
          <div id="savedCustomsList"></div>
        </div>
      </div>

    </div>

    <!-- MIDDLE: Today's Goals (full-width on mobile, spans both cols on desktop) -->
    <div class="goals-panel" style="margin-top:0; border-radius:16px; animation-delay:0.1s">
      <div class="goals-header" onclick="toggleGoals()" id="goalsHeader">
        <div class="goals-header-left">
          <div class="panel-title" style="margin:0">ðŸŽ¯ Today's Goals</div>
          <span style="font-size:0.72rem;color:var(--muted)" id="goalsSubtitle">enter weight &amp; select day type</span>
        </div>
        <span class="goals-toggle-icon" id="goalsToggleIcon">â–¼</span>
      </div>
      <div class="goals-body" id="goalsBody">

        <!-- Step 1: Weight -->
        <div class="section-label" style="margin-bottom:10px">Your weight</div>
        <div class="goals-setup-row">
          <div class="weight-field">
            <label>Body Weight</label>
            <div class="weight-input-row">
              <input type="number" id="bodyWeight" placeholder="70" min="30" max="300" step="0.5" oninput="onWeightOrDayChange()">
              <div class="weight-unit-toggle">
                <button id="btnKg" class="active" onclick="setWeightUnit('kg')">kg</button>
                <button id="btnLbs" onclick="setWeightUnit('lbs')">lbs</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Day type -->
        <div class="section-label" style="margin-bottom:10px">Training day type</div>
        <div class="day-type-row">
          <div class="day-type-card" id="dayHigh" onclick="selectDayType('high')">
            <div class="day-icon">ðŸ”¥</div>
            <div class="day-label">High Intensity</div>
            <div class="day-desc">Hard ride, race, or intervals</div>
          </div>
          <div class="day-type-card" id="dayRegular" onclick="selectDayType('regular')">
            <div class="day-icon">ðŸš´</div>
            <div class="day-label">Regular Training</div>
            <div class="day-desc">Moderate endurance ride</div>
          </div>
          <div class="day-type-card" id="dayRecovery" onclick="selectDayType('recovery')">
            <div class="day-icon">ðŸ’¤</div>
            <div class="day-label">Recovery Day</div>
            <div class="day-desc">Rest, easy spin, or off-bike</div>
          </div>
        </div>

        <!-- Calculated targets -->
        <div class="section-label" style="margin-bottom:10px">Calculated targets <span style="font-weight:400;text-transform:none;letter-spacing:0;font-size:0.7rem">(editable)</span></div>
        <div class="goals-grid">
          <div class="goal-field">
            <label>Calories</label>
            <input type="number" id="goalCal" placeholder="â€”" min="0" oninput="onGoalChange()">
            <div class="goal-unit">kcal</div>
          </div>
          <div class="goal-field">
            <label>Protein</label>
            <input type="number" id="goalProtein" placeholder="â€”" min="0" oninput="onGoalChange()">
            <div class="goal-unit">grams</div>
          </div>
          <div class="goal-field">
            <label>Carbs</label>
            <input type="number" id="goalCarbs" placeholder="â€”" min="0" oninput="onGoalChange()">
            <div class="goal-unit">grams</div>
          </div>
          <div class="goal-field">
            <label>Fat</label>
            <input type="number" id="goalFat" placeholder="â€”" min="0" oninput="onGoalChange()">
            <div class="goal-unit">grams</div>
          </div>
        </div>
        <div class="goals-formula-note" id="goalsFormulaNote"></div>
      </div>
    </div>

    <!-- RIGHT: Daily log -->
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <div>
          <div class="panel-title" style="margin:0">Today's Food Log</div>
          <div style="font-size:0.68rem;color:var(--muted);margin-top:3px" id="logDateLabel"></div>
        </div>
        <button class="btn btn-ghost" style="font-size:0.72rem;padding:6px 12px" onclick="clearAll()">Clear all</button>
      </div>
      <ul class="ingredient-list" id="ingredientList"><li class="empty-state"><div class="icon">ðŸ¥—</div>Add ingredients to start building your daily log</li></ul>
    </div>
  </div>

  <!-- Mixtures -->
  <div class="mixtures-panel">
    <div class="mixtures-header" onclick="toggleMixtures()">
      <div class="goals-header-left">
        <div class="panel-title" style="margin:0">ðŸ¥— Mixtures</div>
        <span style="font-size:0.72rem;color:var(--muted)" id="mixturesSubtitle">salads, nut mixes, batch recipes</span>
      </div>
      <span class="goals-toggle-icon" id="mixturesToggleIcon">â–¼</span>
    </div>
    <div class="mixtures-body" id="mixturesBody">

      <!-- Quick-add chips for saved mixtures -->
      <div id="mixturesQuickAdd" style="display:none">
        <div class="section-label" style="margin-bottom:8px">Your mixtures</div>
        <div class="mixtures-quickadd" id="mixturesChips"></div>
        <div id="mixtureCardsList"></div>
        <hr class="divider">
      </div>

      <!-- Builder -->
      <div class="mixture-builder" id="mixtureBuilder">
        <div class="mixture-builder-title" id="builderTitle">âœ¦ New Mixture</div>

        <div class="mix-name-row">
          <input type="text" id="mixName" placeholder="Mixture name (e.g. Trail Mix, Kale Salad)">
        </div>

        <div class="section-label" style="margin-bottom:8px">Add ingredients to mixture</div>
        <div class="mix-search-row">
          <input type="text" id="mixIngInput" placeholder="ingredient name..." list="ingredientSuggestions" onkeydown="if(event.key==='Enter') addMixIngredient()">
          <input type="number" id="mixIngAmount" placeholder="100" value="100" min="0.1" step="0.1">
          <select id="mixIngUnit">
            <option value="g">g</option>
            <option value="oz">oz</option>
            <option value="tsp">tsp</option>
            <option value="tbsp">tbsp</option>
            <option value="cup">cup</option>
          </select>
          <button class="mix-btn" onclick="addMixIngredient()">Add</button>
        </div>
        <ul class="mix-ing-list" id="mixIngList"><li style="font-size:0.78rem;color:var(--muted);padding:6px 0">No ingredients yet â€” add some above.</li></ul>

        <div class="mix-yield-row">
          <label>Total batch yield</label>
          <input type="number" id="mixYield" placeholder="auto" min="1" step="1" oninput="renderMixPreview()">
          <select id="mixYieldUnit" onchange="renderMixPreview()">
            <option value="g">g</option>
            <option value="oz">oz</option>
          </select>
          <span class="mix-yield-note">Leave blank to use ingredient sum (<span id="mixIngTotal">0g</span>)</span>
        </div>

        <!-- Live nutrition preview -->
        <div class="mix-preview" id="mixPreview" style="display:none">
          <div class="mix-preview-title">Nutrition per 100g of mixture</div>
          <div class="mix-preview-grid" id="mixPreviewGrid"></div>
        </div>

        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="mix-btn ghost" onclick="cancelMixEdit()" id="mixCancelBtn" style="display:none">Cancel</button>
          <button class="mix-btn ghost" onclick="clearMixBuilder()">Clear</button>
          <button class="mix-btn" style="flex:1" onclick="saveMixture()">Save Mixture</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Results -->
  <div class="results-panel" id="resultsPanel">
    <div class="panel-title">Nutritional Analysis</div>
    <div id="resultsContent"><div class="empty-state"><div class="icon">ðŸ“Š</div>Your meal nutrition will appear here once you add ingredients above.</div></div>
  </div>
</div>

<script>
// â”€â”€ Nutrition database (per 100g) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DB = {
  // Proteins
  "tofu":           { cal:76,  protein:8,   carbs:1.9, fat:4.8, fiber:0.3, iron:1.6, calcium:350,potassium:121, vitC:0.1, vitB12:0, zinc:0.8, magnesium:30 },
  "tempeh":         { cal:193, protein:19,  carbs:9.4, fat:11,  fiber:1.8, iron:2.7, calcium:111,potassium:401, vitC:0,   vitB12:0, zinc:1.7, magnesium:81 },
  "edamame":        { cal:121, protein:11,  carbs:8.9, fat:5.2, fiber:5.2, iron:2.3, calcium:63, potassium:436, vitC:6.1, vitB12:0, zinc:1.4, magnesium:64 },
  "lentils":        { cal:116, protein:9,   carbs:20,  fat:0.4, fiber:7.9, iron:3.3, calcium:19, potassium:369, vitC:1.5, vitB12:0, zinc:1.3, magnesium:36 },
  "green lentils":  { cal:106, protein:9,   carbs:19,  fat:0.4, fiber:7.8, iron:3.2, calcium:25, potassium:370, vitC:1.5, vitB12:0, zinc:1.3, magnesium:36 },
  "chickpeas":      { cal:164, protein:9,   carbs:27,  fat:2.6, fiber:7.6, iron:2.9, calcium:49, potassium:291, vitC:1.3, vitB12:0, zinc:1.5, magnesium:48 },
  "black beans":    { cal:132, protein:8.9, carbs:24,  fat:0.5, fiber:8.7, iron:2.1, calcium:27, potassium:355, vitC:0,   vitB12:0, zinc:1.0, magnesium:60 },
  "greek yogurt":   { cal:97,  protein:9,   carbs:3.6, fat:5,   fiber:0,   iron:0.1, calcium:110,potassium:141, vitC:0,   vitB12:1.3,zinc:0.5, magnesium:11 },
  "cottage cheese": { cal:98,  protein:11,  carbs:3.4, fat:4.3, fiber:0,   iron:0.1, calcium:83, potassium:104, vitC:0,   vitB12:0.4,zinc:0.4, magnesium:8  },
  "eggs":           { cal:155, protein:13,  carbs:1.1, fat:11,  fiber:0,   iron:1.8, calcium:56, potassium:138, vitC:0,   vitB12:1.1,zinc:1.3, magnesium:12 },
  // Animal proteins
  "chicken breast":       { cal:165, protein:31,  carbs:0,   fat:3.6, fiber:0, iron:0.7, calcium:15,  potassium:256, vitC:0,   vitB12:0.3, zinc:1.0, magnesium:29 },
  "ground turkey":        { cal:189, protein:27,  carbs:0,   fat:9,   fiber:0, iron:1.5, calcium:21,  potassium:291, vitC:0,   vitB12:1.3, zinc:2.5, magnesium:24 },
  "turkey breast":        { cal:135, protein:30,  carbs:0,   fat:1,   fiber:0, iron:1.4, calcium:18,  potassium:298, vitC:0,   vitB12:0.5, zinc:1.7, magnesium:28 },
  "salmon":               { cal:208, protein:20,  carbs:0,   fat:13,  fiber:0, iron:0.8, calcium:12,  potassium:363, vitC:3.9, vitB12:3.2, zinc:0.6, magnesium:27 },
  "tuna":                 { cal:116, protein:26,  carbs:0,   fat:1,   fiber:0, iron:1.0, calcium:10,  potassium:441, vitC:0,   vitB12:2.3, zinc:0.6, magnesium:35 },
  "canned tuna":          { cal:109, protein:25,  carbs:0,   fat:0.8, fiber:0, iron:1.3, calcium:11,  potassium:237, vitC:0,   vitB12:2.1, zinc:0.7, magnesium:31 },
  "shrimp":               { cal:99,  protein:24,  carbs:0.2, fat:0.3, fiber:0, iron:0.5, calcium:64,  potassium:259, vitC:0,   vitB12:1.1, zinc:1.1, magnesium:37 },
  "tilapia":              { cal:96,  protein:20,  carbs:0,   fat:1.7, fiber:0, iron:0.6, calcium:14,  potassium:302, vitC:0,   vitB12:1.6, zinc:0.4, magnesium:27 },
  "cod":                  { cal:82,  protein:18,  carbs:0,   fat:0.7, fiber:0, iron:0.4, calcium:16,  potassium:413, vitC:1.0, vitB12:0.9, zinc:0.4, magnesium:32 },
  "sardines":             { cal:208, protein:25,  carbs:0,   fat:11,  fiber:0, iron:2.9, calcium:382, potassium:397, vitC:0,   vitB12:8.9, zinc:1.3, magnesium:39 },
  "beef sirloin":         { cal:207, protein:26,  carbs:0,   fat:11,  fiber:0, iron:2.6, calcium:18,  potassium:318, vitC:0,   vitB12:1.9, zinc:5.5, magnesium:23 },
  "ground beef":          { cal:254, protein:26,  carbs:0,   fat:17,  fiber:0, iron:2.4, calcium:18,  potassium:270, vitC:0,   vitB12:2.3, zinc:6.3, magnesium:21 },
  "lean ground beef":     { cal:215, protein:27,  carbs:0,   fat:12,  fiber:0, iron:2.5, calcium:19,  potassium:289, vitC:0,   vitB12:2.5, zinc:6.5, magnesium:22 },
  "pork tenderloin":      { cal:143, protein:26,  carbs:0,   fat:3.5, fiber:0, iron:1.1, calcium:20,  potassium:423, vitC:0.6, vitB12:0.7, zinc:2.2, magnesium:28 },
  "whey protein powder":  { cal:400, protein:80,  carbs:8,   fat:5,   fiber:0, iron:0.5, calcium:600, potassium:500, vitC:0,   vitB12:1.2, zinc:3.5, magnesium:60 },
  "casein protein powder":{ cal:370, protein:75,  carbs:10,  fat:3,   fiber:0, iron:0.4, calcium:800, potassium:450, vitC:0,   vitB12:1.0, zinc:3.0, magnesium:55 },
  // Grains
  "quinoa":         { cal:120, protein:4.4, carbs:22,  fat:1.9, fiber:2.8, iron:1.5, calcium:17, potassium:172, vitC:0,   vitB12:0, zinc:1.1, magnesium:64 },
  "brown rice":     { cal:112, protein:2.6, carbs:23,  fat:0.9, fiber:1.8, iron:0.5, calcium:10, potassium:79,  vitC:0,   vitB12:0, zinc:0.6, magnesium:43 },
  "oats":           { cal:389, protein:17,  carbs:66,  fat:7,   fiber:10,  iron:4.7, calcium:54, potassium:429, vitC:0,   vitB12:0, zinc:3.9, magnesium:177},
  "whole wheat bread":{ cal:247, protein:13, carbs:41, fat:3.4, fiber:7,   iron:3.6, calcium:107,potassium:248, vitC:0,   vitB12:0, zinc:1.5, magnesium:76 },
  "barley":           { cal:354, protein:12, carbs:74,  fat:2.3, fiber:17,  iron:3.6, calcium:33, potassium:452, vitC:0,   vitB12:0, zinc:2.8, magnesium:133},
  // Vegetables
  "spinach":        { cal:23,  protein:2.9, carbs:3.6, fat:0.4, fiber:2.2, iron:2.7, calcium:99, potassium:558, vitC:28,  vitB12:0, zinc:0.5, magnesium:79 },
  "kale":           { cal:49,  protein:4.3, carbs:9,   fat:0.9, fiber:3.6, iron:1.5, calcium:150,potassium:491, vitC:120, vitB12:0, zinc:0.4, magnesium:47 },
  "broccoli":       { cal:34,  protein:2.8, carbs:7,   fat:0.4, fiber:2.6, iron:0.7, calcium:47, potassium:316, vitC:89,  vitB12:0, zinc:0.4, magnesium:21 },
  "sweet potato":   { cal:86,  protein:1.6, carbs:20,  fat:0.1, fiber:3,   iron:0.6, calcium:30, potassium:337, vitC:19,  vitB12:0, zinc:0.3, magnesium:25 },
  "avocado":        { cal:160, protein:2,   carbs:9,   fat:15,  fiber:6.7, iron:0.6, calcium:12, potassium:485, vitC:10,  vitB12:0, zinc:0.6, magnesium:29 },
  "carrot":         { cal:41,  protein:0.9, carbs:10,  fat:0.2, fiber:2.8, iron:0.3, calcium:33, potassium:320, vitC:5.9, vitB12:0, zinc:0.2, magnesium:12 },
  "celery":         { cal:16,  protein:0.7, carbs:3,   fat:0.2, fiber:1.6, iron:0.2, calcium:40, potassium:260, vitC:3.1, vitB12:0, zinc:0.1, magnesium:11 },
  "cucumber":       { cal:15,  protein:0.7, carbs:3.6, fat:0.1, fiber:0.5, iron:0.3, calcium:16, potassium:147, vitC:2.8, vitB12:0, zinc:0.2, magnesium:13 },
  "tomato":         { cal:18,  protein:0.9, carbs:3.9, fat:0.2, fiber:1.2, iron:0.3, calcium:10, potassium:237, vitC:14,  vitB12:0, zinc:0.2, magnesium:11 },
  "bell pepper":    { cal:31,  protein:1,   carbs:6,   fat:0.3, fiber:2.1, iron:0.4, calcium:10, potassium:211, vitC:128, vitB12:0, zinc:0.2, magnesium:10 },
  "red bell pepper":{ cal:31,  protein:1,   carbs:6,   fat:0.3, fiber:2.1, iron:0.4, calcium:10, potassium:211, vitC:128, vitB12:0, zinc:0.2, magnesium:10 },
  "onion":          { cal:40,  protein:1.1, carbs:9.3, fat:0.1, fiber:1.7, iron:0.2, calcium:23, potassium:146, vitC:7.4, vitB12:0, zinc:0.2, magnesium:10 },
  "garlic":         { cal:149, protein:6.4, carbs:33,  fat:0.5, fiber:2.1, iron:1.7, calcium:181,potassium:401, vitC:31,  vitB12:0, zinc:1.2, magnesium:25 },
  "mushrooms":      { cal:22,  protein:3.1, carbs:3.3, fat:0.3, fiber:1,   iron:0.5, calcium:3,  potassium:318, vitC:2.1, vitB12:0, zinc:0.5, magnesium:9  },
  "zucchini":       { cal:17,  protein:1.2, carbs:3.1, fat:0.3, fiber:1,   iron:0.4, calcium:16, potassium:261, vitC:17,  vitB12:0, zinc:0.3, magnesium:18 },
  "cauliflower":    { cal:25,  protein:1.9, carbs:5,   fat:0.3, fiber:2,   iron:0.4, calcium:22, potassium:299, vitC:48,  vitB12:0, zinc:0.3, magnesium:15 },
  "brussels sprouts":{ cal:43, protein:3.4, carbs:9,   fat:0.3, fiber:3.8, iron:1.4, calcium:42, potassium:389, vitC:85,  vitB12:0, zinc:0.4, magnesium:23 },
  "green beans":    { cal:31,  protein:1.8, carbs:7,   fat:0.2, fiber:2.7, iron:1,   calcium:37, potassium:211, vitC:12,  vitB12:0, zinc:0.2, magnesium:25 },
  "peas":           { cal:81,  protein:5.4, carbs:14,  fat:0.4, fiber:5.1, iron:1.5, calcium:25, potassium:244, vitC:40,  vitB12:0, zinc:1.2, magnesium:33 },
  "corn":           { cal:86,  protein:3.2, carbs:19,  fat:1.2, fiber:2.7, iron:0.5, calcium:2,  potassium:270, vitC:6.8, vitB12:0, zinc:0.5, magnesium:37 },
  "potato":         { cal:77,  protein:2,   carbs:17,  fat:0.1, fiber:2.2, iron:0.8, calcium:12, potassium:421, vitC:19,  vitB12:0, zinc:0.3, magnesium:23 },
  "beet":           { cal:43,  protein:1.6, carbs:10,  fat:0.2, fiber:2.8, iron:0.8, calcium:16, potassium:325, vitC:4.9, vitB12:0, zinc:0.4, magnesium:23 },
  "asparagus":      { cal:20,  protein:2.2, carbs:3.9, fat:0.1, fiber:2.1, iron:2.1, calcium:24, potassium:202, vitC:5.6, vitB12:0, zinc:0.5, magnesium:14 },
  "cabbage":        { cal:25,  protein:1.3, carbs:5.8, fat:0.1, fiber:2.5, iron:0.5, calcium:40, potassium:170, vitC:36,  vitB12:0, zinc:0.2, magnesium:12 },
  "bok choy":       { cal:13,  protein:1.5, carbs:2.2, fat:0.2, fiber:1,   iron:0.8, calcium:105,potassium:252, vitC:45,  vitB12:0, zinc:0.2, magnesium:19 },
  "arugula":        { cal:25,  protein:2.6, carbs:3.7, fat:0.7, fiber:1.6, iron:1.5, calcium:160,potassium:369, vitC:15,  vitB12:0, zinc:0.5, magnesium:47 },
  "swiss chard":    { cal:19,  protein:1.8, carbs:3.7, fat:0.2, fiber:1.6, iron:1.8, calcium:51, potassium:379, vitC:30,  vitB12:0, zinc:0.4, magnesium:81 },
  "collard greens": { cal:32,  protein:3,   carbs:5.7, fat:0.6, fiber:4,   iron:0.5, calcium:232,potassium:213, vitC:35,  vitB12:0, zinc:0.2, magnesium:27 },
  "eggplant":       { cal:25,  protein:1,   carbs:6,   fat:0.2, fiber:3,   iron:0.2, calcium:9,  potassium:229, vitC:2.2, vitB12:0, zinc:0.1, magnesium:14 },
  "leek":           { cal:61,  protein:1.5, carbs:14,  fat:0.3, fiber:1.8, iron:2.1, calcium:59, potassium:180, vitC:12,  vitB12:0, zinc:0.1, magnesium:28 },
  "butternut squash":{ cal:45, protein:1,   carbs:12,  fat:0.1, fiber:2,   iron:0.7, calcium:48, potassium:352, vitC:21,  vitB12:0, zinc:0.2, magnesium:34 },
  "acorn squash":   { cal:40,  protein:0.9, carbs:10,  fat:0.1, fiber:1.5, iron:0.6, calcium:44, potassium:347, vitC:11,  vitB12:0, zinc:0.2, magnesium:43 },
  "artichoke":      { cal:47,  protein:3.3, carbs:11,  fat:0.2, fiber:5.4, iron:1.3, calcium:44, potassium:370, vitC:11,  vitB12:0, zinc:0.5, magnesium:60 },
  "turnip":         { cal:28,  protein:0.9, carbs:6.4, fat:0.1, fiber:1.8, iron:0.3, calcium:30, potassium:191, vitC:21,  vitB12:0, zinc:0.3, magnesium:11 },
  "radish":         { cal:16,  protein:0.7, carbs:3.4, fat:0.1, fiber:1.6, iron:0.3, calcium:25, potassium:233, vitC:14,  vitB12:0, zinc:0.3, magnesium:10 },
  // Fruits
  "banana":         { cal:89,  protein:1.1, carbs:23,  fat:0.3, fiber:2.6, iron:0.3, calcium:5,  potassium:358, vitC:8.7, vitB12:0, zinc:0.2, magnesium:27 },
  "apple":          { cal:52,  protein:0.3, carbs:14,  fat:0.2, fiber:2.4, iron:0.1, calcium:6,  potassium:107, vitC:4.6, vitB12:0, zinc:0.0, magnesium:5  },
  "orange":         { cal:47,  protein:0.9, carbs:12,  fat:0.1, fiber:2.4, iron:0.1, calcium:40, potassium:181, vitC:53,  vitB12:0, zinc:0.1, magnesium:10 },
  "blueberries":    { cal:57,  protein:0.7, carbs:14,  fat:0.3, fiber:2.4, iron:0.3, calcium:6,  potassium:77,  vitC:9.7, vitB12:0, zinc:0.2, magnesium:6  },
  "strawberries":   { cal:32,  protein:0.7, carbs:7.7, fat:0.3, fiber:2,   iron:0.4, calcium:16, potassium:153, vitC:59,  vitB12:0, zinc:0.1, magnesium:13 },
  "mango":          { cal:60,  protein:0.8, carbs:15,  fat:0.4, fiber:1.6, iron:0.2, calcium:11, potassium:168, vitC:36,  vitB12:0, zinc:0.1, magnesium:10 },
  "pineapple":      { cal:50,  protein:0.5, carbs:13,  fat:0.1, fiber:1.4, iron:0.3, calcium:13, potassium:109, vitC:47,  vitB12:0, zinc:0.1, magnesium:12 },
  "grapes":         { cal:69,  protein:0.7, carbs:18,  fat:0.2, fiber:0.9, iron:0.4, calcium:10, potassium:191, vitC:3.2, vitB12:0, zinc:0.1, magnesium:7  },
  "watermelon":     { cal:30,  protein:0.6, carbs:7.6, fat:0.2, fiber:0.4, iron:0.2, calcium:7,  potassium:112, vitC:8.1, vitB12:0, zinc:0.1, magnesium:10 },
  "peach":          { cal:39,  protein:0.9, carbs:10,  fat:0.3, fiber:1.5, iron:0.3, calcium:6,  potassium:190, vitC:6.6, vitB12:0, zinc:0.2, magnesium:9  },
  "pear":           { cal:57,  protein:0.4, carbs:15,  fat:0.1, fiber:3.1, iron:0.2, calcium:9,  potassium:116, vitC:4.3, vitB12:0, zinc:0.1, magnesium:7  },
  "kiwi":           { cal:61,  protein:1.1, carbs:15,  fat:0.5, fiber:3,   iron:0.3, calcium:34, potassium:312, vitC:93,  vitB12:0, zinc:0.1, magnesium:17 },
  "lemon":          { cal:29,  protein:1.1, carbs:9.3, fat:0.3, fiber:2.8, iron:0.6, calcium:26, potassium:138, vitC:53,  vitB12:0, zinc:0.1, magnesium:8  },
  "cherries":       { cal:50,  protein:1,   carbs:12,  fat:0.3, fiber:1.6, iron:0.4, calcium:13, potassium:222, vitC:7,   vitB12:0, zinc:0.1, magnesium:11 },
  "raspberries":    { cal:52,  protein:1.2, carbs:12,  fat:0.7, fiber:6.5, iron:0.7, calcium:25, potassium:151, vitC:26,  vitB12:0, zinc:0.4, magnesium:22 },
  "blackberries":   { cal:43,  protein:1.4, carbs:10,  fat:0.5, fiber:5.3, iron:0.6, calcium:29, potassium:162, vitC:21,  vitB12:0, zinc:0.5, magnesium:20 },
  "pomegranate":    { cal:83,  protein:1.7, carbs:19,  fat:1.2, fiber:4,   iron:0.3, calcium:10, potassium:236, vitC:10,  vitB12:0, zinc:0.4, magnesium:12 },
  "papaya":         { cal:43,  protein:0.5, carbs:11,  fat:0.3, fiber:1.7, iron:0.3, calcium:20, potassium:182, vitC:62,  vitB12:0, zinc:0.1, magnesium:21 },
  // Dried Fruits
  "raisins":           { cal:299, protein:3.1, carbs:79,  fat:0.5, fiber:3.7, iron:1.9, calcium:50, potassium:749, vitC:2.3, vitB12:0, zinc:0.2, magnesium:32 },
  "dates":             { cal:282, protein:2.5, carbs:75,  fat:0.4, fiber:8,   iron:1.0, calcium:64, potassium:696, vitC:0,   vitB12:0, zinc:0.4, magnesium:54 },
  "medjool dates":     { cal:277, protein:1.8, carbs:75,  fat:0.2, fiber:6.7, iron:0.9, calcium:64, potassium:696, vitC:0,   vitB12:0, zinc:0.4, magnesium:54 },
  "dried apricots":    { cal:241, protein:3.4, carbs:63,  fat:0.5, fiber:7.3, iron:2.7, calcium:55, potassium:1162,vitC:1,   vitB12:0, zinc:0.4, magnesium:32 },
  "dried cranberries": { cal:308, protein:0.1, carbs:82,  fat:1.4, fiber:5.7, iron:0.3, calcium:9,  potassium:49,  vitC:0.2, vitB12:0, zinc:0.1, magnesium:6  },
  "dried mango":       { cal:319, protein:2.7, carbs:78,  fat:1.2, fiber:2.4, iron:1.0, calcium:23, potassium:279, vitC:14,  vitB12:0, zinc:0.2, magnesium:18 },
  "dried figs":        { cal:249, protein:3.3, carbs:64,  fat:0.9, fiber:9.8, iron:2.0, calcium:162,potassium:680, vitC:1.2, vitB12:0, zinc:0.5, magnesium:68 },
  "prunes":            { cal:240, protein:2.2, carbs:64,  fat:0.4, fiber:7.1, iron:0.9, calcium:43, potassium:732, vitC:0.6, vitB12:0, zinc:0.4, magnesium:41 },
  "dried blueberries": { cal:317, protein:0.3, carbs:84,  fat:1.1, fiber:4,   iron:0.4, calcium:8,  potassium:67,  vitC:0,   vitB12:0, zinc:0.1, magnesium:7  },
  "dried cherries":    { cal:283, protein:2.6, carbs:72,  fat:0.5, fiber:3.5, iron:0.7, calcium:25, potassium:495, vitC:0,   vitB12:0, zinc:0.2, magnesium:22 },
  "dried goji berries":{ cal:349, protein:14,  carbs:77,  fat:0.4, fiber:13,  iron:6.8, calcium:190,potassium:1132,vitC:48,  vitB12:0, zinc:2.0, magnesium:83 },
  "dried pineapple":   { cal:346, protein:1.4, carbs:86,  fat:1.3, fiber:6.8, iron:1.3, calcium:51, potassium:581, vitC:10,  vitB12:0, zinc:0.3, magnesium:54 },
  "sultanas":          { cal:299, protein:3.1, carbs:79,  fat:0.5, fiber:3.7, iron:1.9, calcium:50, potassium:749, vitC:2.3, vitB12:0, zinc:0.2, magnesium:32 },
  "almonds":           { cal:579, protein:21,  carbs:22,  fat:50,  fiber:12.5,iron:3.7, calcium:264,potassium:733, vitC:0,   vitB12:0, zinc:3.1, magnesium:270},
  "walnuts":           { cal:654, protein:15,  carbs:14,  fat:65,  fiber:6.7, iron:2.9, calcium:98, potassium:441, vitC:1.3, vitB12:0, zinc:3.1, magnesium:158},
  "cashews":           { cal:553, protein:18,  carbs:30,  fat:44,  fiber:3.3, iron:6.7, calcium:37, potassium:660, vitC:0.5, vitB12:0, zinc:5.8, magnesium:292},
  "pistachios":        { cal:560, protein:20,  carbs:28,  fat:45,  fiber:10.6,iron:3.9, calcium:105,potassium:1025,vitC:5.6, vitB12:0, zinc:2.2, magnesium:121},
  "pecans":            { cal:691, protein:9.2, carbs:14,  fat:72,  fiber:9.6, iron:2.5, calcium:70, potassium:410, vitC:1.1, vitB12:0, zinc:4.5, magnesium:121},
  "macadamia nuts":    { cal:718, protein:7.9, carbs:14,  fat:76,  fiber:8.6, iron:3.7, calcium:85, potassium:368, vitC:1.2, vitB12:0, zinc:1.3, magnesium:130},
  "brazil nuts":       { cal:659, protein:14,  carbs:12,  fat:67,  fiber:7.5, iron:2.4, calcium:160,potassium:659, vitC:0.7, vitB12:0, zinc:4.1, magnesium:376},
  "hazelnuts":         { cal:628, protein:15,  carbs:17,  fat:61,  fiber:9.7, iron:4.7, calcium:114,potassium:680, vitC:6.3, vitB12:0, zinc:2.4, magnesium:163},
  "pine nuts":         { cal:673, protein:14,  carbs:13,  fat:68,  fiber:3.7, iron:5.5, calcium:16, potassium:597, vitC:0.8, vitB12:0, zinc:6.5, magnesium:251},
  "peanuts":           { cal:567, protein:26,  carbs:16,  fat:49,  fiber:8.5, iron:4.6, calcium:92, potassium:705, vitC:0,   vitB12:0, zinc:3.3, magnesium:168},
  "sunflower seeds":   { cal:584, protein:21,  carbs:20,  fat:51,  fiber:8.6, iron:5.3, calcium:78, potassium:645, vitC:1.4, vitB12:0, zinc:5.0, magnesium:325},
  "sesame seeds":      { cal:573, protein:18,  carbs:23,  fat:50,  fiber:11.8,iron:14.6,calcium:975,potassium:468, vitC:0,   vitB12:0, zinc:7.8, magnesium:351},
  "flaxseeds":         { cal:534, protein:18,  carbs:29,  fat:42,  fiber:27,  iron:5.7, calcium:255,potassium:813, vitC:0.6, vitB12:0, zinc:4.3, magnesium:392},
  "tahini":            { cal:595, protein:17,  carbs:21,  fat:54,  fiber:9.3, iron:8.9, calcium:426,potassium:414, vitC:0,   vitB12:0, zinc:4.6, magnesium:95 },
  "almond butter":     { cal:614, protein:21,  carbs:19,  fat:56,  fiber:10.5,iron:3.5, calcium:347,potassium:748, vitC:0,   vitB12:0, zinc:3.0, magnesium:279},
  "cashew butter":     { cal:587, protein:17,  carbs:27,  fat:50,  fiber:2.1, iron:5.6, calcium:43, potassium:546, vitC:0,   vitB12:0, zinc:5.3, magnesium:260},
  "mixed nuts":        { cal:607, protein:15,  carbs:21,  fat:54,  fiber:5.3, iron:2.6, calcium:96, potassium:601, vitC:0.4, vitB12:0, zinc:3.3, magnesium:183},
  "chia seeds":     { cal:486, protein:17,  carbs:42,  fat:31,  fiber:34,  iron:7.7, calcium:631,potassium:407, vitC:1.6, vitB12:0, zinc:4.6, magnesium:335},
  "hemp seeds":     { cal:553, protein:32,  carbs:8.7, fat:49,  fiber:4,   iron:7.9, calcium:70, potassium:1200,vitC:1,   vitB12:0, zinc:9.9, magnesium:700},
  "pumpkin seeds":  { cal:559, protein:30,  carbs:11,  fat:49,  fiber:6,   iron:8.8, calcium:46, potassium:809, vitC:1.9, vitB12:0, zinc:7.8, magnesium:592},
  "peanut butter":  { cal:588, protein:25,  carbs:20,  fat:50,  fiber:6,   iron:1.9, calcium:43, potassium:558, vitC:0,   vitB12:0, zinc:2.9, magnesium:154},
  // â”€â”€ NEW: Hulled hemp seeds (alias of hemp seeds, slightly higher protein when hulled) â”€â”€
  "hulled hemp seeds":{ cal:566, protein:32, carbs:8.7, fat:50,  fiber:4,   iron:7.9, calcium:70, potassium:1200,vitC:1,   vitB12:0, zinc:9.9, magnesium:700},
  // â”€â”€ NEW: Flaxseed meal (ground flax) â”€â”€
  "flaxseed meal":  { cal:534, protein:18,  carbs:29,  fat:42,  fiber:27,  iron:5.7, calcium:255,potassium:813, vitC:0.6, vitB12:0, zinc:4.3, magnesium:392},
  "flax seed meal": { cal:534, protein:18,  carbs:29,  fat:42,  fiber:27,  iron:5.7, calcium:255,potassium:813, vitC:0.6, vitB12:0, zinc:4.3, magnesium:392},
  // â”€â”€ NEW: Chai seeds (alias for chia seeds â€” likely a typo of "chia") â”€â”€
  "chai seeds":     { cal:486, protein:17,  carbs:42,  fat:31,  fiber:34,  iron:7.7, calcium:631,potassium:407, vitC:1.6, vitB12:0, zinc:4.6, magnesium:335},
  // â”€â”€ NEW: Cinnamon powder â”€â”€
  "cinnamon powder":{ cal:247, protein:4,   carbs:81,  fat:1.2, fiber:53,  iron:8.3, calcium:1002,potassium:431,vitC:3.8, vitB12:0, zinc:1.8, magnesium:60 },
  // â”€â”€ NEW: Unsweetened shredded/desiccated coconut â”€â”€
  "unsweetened coconut":{ cal:660, protein:6.9, carbs:24, fat:65, fiber:16, iron:3.3, calcium:26, potassium:543, vitC:3.3, vitB12:0, zinc:2.0, magnesium:105},
  // â”€â”€ NEW: Whole Foods 365 Organic Oat & Honey Granola (per 100g, ~420 kcal) â”€â”€
  "oat honey granola":  { cal:420, protein:9,   carbs:63,  fat:15,  fiber:5,   iron:3.2, calcium:40, potassium:280, vitC:0,   vitB12:0, zinc:2.0, magnesium:70 },
  // â”€â”€ NEW: Trader Joe's Organic Creamy Cashew Cultured Yogurt Alternative, Plain Unsweetened â”€â”€
  // Per 100g: 0.75 cup (171g) = 140 cal, 9g fat, 11g carbs, 1g fiber, 4g protein â†’ scaled to 100g
  "tj cashew yogurt":   { cal:82,  protein:2.3, carbs:6.4, fat:5.3, fiber:0.6, iron:0.9, calcium:20, potassium:130, vitC:0,   vitB12:0, zinc:0.4, magnesium:25 },
  "cashew yogurt":      { cal:82,  protein:2.3, carbs:6.4, fat:5.3, fiber:0.6, iron:0.9, calcium:20, potassium:130, vitC:0,   vitB12:0, zinc:0.4, magnesium:25 },
  // â”€â”€ NEW: WFM Forbidden Rice Sourdough â”€â”€
  // Per 1 slice (~50g): 120 cal, 4g protein, 22g carbs, 2g fat â†’ scaled to 100g
  "forbidden rice sourdough": { cal:240, protein:8, carbs:44, fat:4, fiber:3, iron:2.8, calcium:30, potassium:120, vitC:0, vitB12:0, zinc:0.9, magnesium:28 },
  "wfm forbidden rice sourdough": { cal:240, protein:8, carbs:44, fat:4, fiber:3, iron:2.8, calcium:30, potassium:120, vitC:0, vitB12:0, zinc:0.9, magnesium:28 },
  // â”€â”€ NEW: Meyenberg Vanilla Goat Yogurt â”€â”€
  // Official label: 170g serving = 150 cal, 5g fat, 22g carbs, 0g fiber, 5g protein, 180mg Ca, 340mg K â†’ per 100g
  "meyenberg vanilla goat yogurt": { cal:88, protein:2.9, carbs:12.9, fat:2.9, fiber:0, iron:0, calcium:106, potassium:200, vitC:0, vitB12:0.4, zinc:0.4, magnesium:14 },
  "vanilla goat yogurt":           { cal:88, protein:2.9, carbs:12.9, fat:2.9, fiber:0, iron:0, calcium:106, potassium:200, vitC:0, vitB12:0.4, zinc:0.4, magnesium:14 },
  // â”€â”€ NEW: Oatly 4 Ingredient Oatmilk â”€â”€
  // Official label: 240ml = 80 cal, 1g fat, 16g carbs, 2g fiber, 3g protein, 70mg K â†’ per 100ml
  "oatly 4 ingredient":          { cal:33, protein:1.3, carbs:6.7, fat:0.4, fiber:0.8, iron:0, calcium:0, potassium:29, vitC:0, vitB12:0, zinc:0.1, magnesium:5 },
  "oatly 4 ingredient oat milk": { cal:33, protein:1.3, carbs:6.7, fat:0.4, fiber:0.8, iron:0, calcium:0, potassium:29, vitC:0, vitB12:0, zinc:0.1, magnesium:5 },
  // â”€â”€ NEW: Raw Tuscan / Lacinato Kale â”€â”€
  "tuscan kale":     { cal:35, protein:2.5, carbs:6.7, fat:0.5, fiber:2.0, iron:1.0, calcium:72, potassium:348, vitC:93, vitB12:0, zinc:0.3, magnesium:18 },
  "lacinato kale":   { cal:35, protein:2.5, carbs:6.7, fat:0.5, fiber:2.0, iron:1.0, calcium:72, potassium:348, vitC:93, vitB12:0, zinc:0.3, magnesium:18 },
  "raw tuscan kale": { cal:35, protein:2.5, carbs:6.7, fat:0.5, fiber:2.0, iron:1.0, calcium:72, potassium:348, vitC:93, vitB12:0, zinc:0.3, magnesium:18 },
  // â”€â”€ NEW: Raw green beans alias â”€â”€
  "raw green beans": { cal:31,  protein:1.8, carbs:7,   fat:0.2, fiber:2.7, iron:1,   calcium:37, potassium:211, vitC:12, vitB12:0, zinc:0.2, magnesium:25 },
  // â”€â”€ NEW: Beets alias â”€â”€
  "beets":           { cal:43,  protein:1.6, carbs:10,  fat:0.2, fiber:2.8, iron:0.8, calcium:16, potassium:325, vitC:4.9, vitB12:0, zinc:0.4, magnesium:23 },
  // â”€â”€ NEW: Red cabbage â”€â”€
  "red cabbage":     { cal:31, protein:1.4, carbs:7.4, fat:0.2, fiber:2.1, iron:0.6, calcium:45, potassium:243, vitC:57, vitB12:0, zinc:0.2, magnesium:16 },
  // â”€â”€ NEW: Green cabbage alias â”€â”€
  "green cabbage":   { cal:25,  protein:1.3, carbs:5.8, fat:0.1, fiber:2.5, iron:0.5, calcium:40, potassium:170, vitC:36, vitB12:0, zinc:0.2, magnesium:12 },
  // â”€â”€ NEW: WFM 365 Organic Original Hummus â”€â”€
  // Official label: 30g (2 tbsp) = 80 cal, 5g fat, 6g carbs, 1g fiber, 2g protein, 0.36mg iron â†’ per 100g
  "wfm organic hummus": { cal:267, protein:6.7, carbs:20, fat:16.7, fiber:3.3, iron:1.2, calcium:40, potassium:200, vitC:2, vitB12:0, zinc:1.2, magnesium:35 },
  "365 organic hummus": { cal:267, protein:6.7, carbs:20, fat:16.7, fiber:3.3, iron:1.2, calcium:40, potassium:200, vitC:2, vitB12:0, zinc:1.2, magnesium:35 },
  "hummus":             { cal:267, protein:6.7, carbs:20, fat:16.7, fiber:3.3, iron:1.2, calcium:40, potassium:200, vitC:2, vitB12:0, zinc:1.2, magnesium:35 },
  // Dairy alternatives
  "soy milk":       { cal:54,  protein:3.3, carbs:6.3, fat:1.8, fiber:0.5, iron:0.6, calcium:123,potassium:118, vitC:0,   vitB12:1.2,zinc:0.3, magnesium:18 },
  "oat milk":       { cal:47,  protein:1,   carbs:7.9, fat:1.5, fiber:0.8, iron:0.2, calcium:120,potassium:62,  vitC:0,   vitB12:0.4,zinc:0.1, magnesium:10 },
  "nutritional yeast":{ cal:325,protein:50, carbs:28,  fat:6,   fiber:14,  iron:4.9, calcium:38, potassium:1500,vitC:0,   vitB12:2.4,zinc:2.9, magnesium:97 },
};

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let meal = [];
let recentlyUsed = []; // ordered list of ingredient names, most recent first

// â”€â”€ Daily log persistence â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function todayKey() {
  // e.g. "vegfuel_log_2025-06-14"
  return 'vegfuel_log_' + new Date().toISOString().slice(0, 10);
}

function saveMeal() {
  // Save today's log; also clear any old keys to keep storage tidy
  const key = todayKey();
  localStorage.setItem(key, JSON.stringify(meal));
  // Remove entries older than today
  Object.keys(localStorage).forEach(k => {
    if (k.startsWith('vegfuel_log_') && k !== key) localStorage.removeItem(k);
  });
}

function loadMeal() {
  const saved = localStorage.getItem(todayKey());
  if (saved) {
    try { meal = JSON.parse(saved); } catch(e) { meal = []; }
  }
}

// â”€â”€ Render recently used chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRecentChips() {
  const section = document.getElementById('recentSection');
  const grid = document.getElementById('recentChips');
  if (!recentlyUsed.length) { section.style.display = 'none'; return; }
  section.style.display = 'block';
  grid.innerHTML = recentlyUsed.map(name => `
    <div class="preset-chip" onclick="quickAdd('${name}')">${name}</div>
  `).join('');
}

function quickAdd(name) {
  const rawAmount = parseFloat(document.getElementById('customAmount').value) || 100;
  const unit = document.getElementById('customUnit').value;
  const amount = toGrams(rawAmount, unit);
  meal.push({ name, amount, displayAmount: rawAmount, unit });
  saveMeal();
  renderMeal(); renderResults();
}

// â”€â”€ Autocomplete suggestions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const dl = document.getElementById('ingredientSuggestions');
Object.keys(DB).forEach(k => {
  const opt = document.createElement('option'); opt.value = k; dl.appendChild(opt);
});

// â”€â”€ Add functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â”€â”€ Unit conversion to grams â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1 oz = 28.3495g, 1 tsp â‰ˆ 4.2g (average density for dry/powder foods)
function toGrams(amount, unit) {
  if (unit === 'oz')   return amount * 28.3495;
  if (unit === 'floz') return amount * 29.5735;
  if (unit === 'tsp')  return amount * 4.2;
  if (unit === 'tbsp') return amount * 12.6;
  if (unit === 'cup')  return amount * 236.6;
  return amount; // already grams
}

function addCustomIngredient() {
  const name = document.getElementById('customInput').value.trim().toLowerCase();
  const rawAmount = parseFloat(document.getElementById('customAmount').value) || 100;
  const unit = document.getElementById('customUnit').value;
  const amount = toGrams(rawAmount, unit);
  if (!name) return alert('Please enter an ingredient name.');
  if (!DB[name]) return alert(`"${name}" not found in our database. Try one of the preset ingredients.`);
  meal.push({ name, amount, displayAmount: rawAmount, unit });
  document.getElementById('customInput').value = '';
  // track recently used (unique, most recent first, max 15)
  recentlyUsed = [name, ...recentlyUsed.filter(n => n !== name)].slice(0, 15);
  renderRecentChips();
  saveMeal();
  renderMeal(); renderResults();
}

function removeIngredient(i) {
  meal.splice(i, 1);
  saveMeal();
  renderMeal(); renderResults();
}

function clearAll() {
  if (meal.length && !confirm('Clear all ingredients logged today?')) return;
  meal = []; recentlyUsed = [];
  saveMeal();
  renderRecentChips(); renderMeal(); renderResults();
}

// â”€â”€ Render ingredient list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMeal() {
  const ul = document.getElementById('ingredientList');
  if (!meal.length) {
    ul.innerHTML = '<li class="empty-state"><div class="icon">ðŸ¥—</div>Add ingredients to start building your daily log</li>';
    return;
  }
  ul.innerHTML = meal.map((item, i) => `
    <li class="ingredient-item">
      <span>${item.name}<span class="amount">${item.displayAmount}${item.unit}</span></span>
      <button class="remove-btn" onclick="removeIngredient(${i})" title="Remove">âœ•</button>
    </li>`).join('');
}

// â”€â”€ Compute totals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function computeTotals() {
  const keys = ['cal','protein','carbs','fat','fiber','iron','calcium','potassium','vitC','vitB12','zinc','magnesium'];
  const totals = Object.fromEntries(keys.map(k => [k, 0]));
  meal.forEach(({name, amount}) => {
    const d = DB[name];
    if (!d) return;
    const mult = amount / 100;
    keys.forEach(k => totals[k] += (d[k] || 0) * mult);
  });
  return totals;
}

// â”€â”€ Athlete tips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getTip(t) {
  if (t.protein < 20) return "âš¡ <strong>Protein is low</strong> â€” consider adding tofu, tempeh, or hemp seeds to support muscle recovery.";
  if (t.iron < 3)   return "ðŸ©¸ <strong>Iron intake is modest</strong> â€” pair iron-rich foods (lentils, spinach) with vitamin C to boost absorption.";
  if (t.cal > 800)  return "ðŸ”¥ <strong>High-energy meal</strong> â€” great for pre/post intense training sessions.";
  if (t.fiber > 15) return "ðŸŒ¿ <strong>Excellent fiber content</strong> â€” supports gut health & sustained energy release.";
  return "ðŸ’ª <strong>Balanced plant-powered meal</strong> â€” you're fueling your body well!";
}

// â”€â”€ DV reference (daily values) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DV = { iron:18, calcium:1000, potassium:3500, vitC:90, vitB12:2.4, zinc:11, magnesium:400 };
const MICRO_COLOR = { iron:'#fb923c', calcium:'#60a5fa', potassium:'#c084fc', vitC:'#4ade80', vitB12:'#f472b6', zinc:'#fbbf24', magnesium:'#34d399' };

// â”€â”€ Render results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderResults() {
  const el = document.getElementById('resultsContent');
  if (!meal.length) {
    el.innerHTML = '<div class="empty-state"><div class="icon">ðŸ“Š</div>Your meal nutrition will appear here once you add ingredients above.</div>';
    return;
  }
  const t = computeTotals();
  const g = getGoals();
  const round1 = v => Math.round(v * 10) / 10;

  function goalBar(val, goal, color) {
    if (!goal) return '';
    const pct = Math.min(120, (val / goal) * 100);
    const over = pct > 100;
    const displayPct = Math.round((val / goal) * 100);
    return `
      <div class="goal-bar-wrap">
        <div class="goal-bar" style="width:${Math.min(100,pct)}%;background:${over ? '#f87171' : color}"></div>
      </div>
      <div class="goal-pct" style="${over ? 'color:#f87171' : ''}">${displayPct}% of goal</div>`;
  }

  function macroCard(val, label, color, goalVal, goalKey) {
    const pct = goalVal ? Math.round((val / goalVal) * 100) : null;
    const over = pct !== null && pct > 100;
    return `<div class="macro-card${over ? ' over' : ''}">
      <div class="val" style="color:${color}">${val}</div>
      <div class="lbl">${label}</div>
      ${goalBar(parseFloat(val), goalVal, color)}
    </div>`;
  }

  el.innerHTML = `
    <div class="macro-grid">
      ${macroCard(Math.round(t.cal),      'Calories', 'var(--orange)', g.cal,     'cal')}
      ${macroCard(round1(t.protein)+'g',  'Protein',  'var(--green)',  g.protein, 'protein')}
      ${macroCard(round1(t.carbs)+'g',    'Carbs',    'var(--blue)',   g.carbs,   'carbs')}
      ${macroCard(round1(t.fat)+'g',      'Fat',      'var(--purple)', g.fat,     'fat')}
    </div>

    <div class="section-label">Fiber & Micronutrients (% Daily Value)</div>
    <div class="micro-grid">
      <div class="micro-card">
        <div class="micro-lbl">Fiber</div>
        <div class="micro-bar-wrap"><div class="micro-bar" style="width:${Math.min(100,(t.fiber/28)*100)}%;background:var(--lime)"></div></div>
        <div class="micro-val">${round1(t.fiber)}g Â· ${Math.round((t.fiber/28)*100)}% DV</div>
      </div>
      ${['iron','calcium','potassium','vitC','vitB12','zinc','magnesium'].map(key => {
        const pct = Math.min(100, (t[key]/DV[key])*100);
        const labels = {iron:'Iron',calcium:'Calcium',potassium:'Potassium',vitC:'Vitamin C',vitB12:'Vitamin B12',zinc:'Zinc',magnesium:'Magnesium'};
        const units = {iron:'mg',calcium:'mg',potassium:'mg',vitC:'mg',vitB12:'Âµg',zinc:'mg',magnesium:'mg'};
        return `<div class="micro-card">
          <div class="micro-lbl">${labels[key]}</div>
          <div class="micro-bar-wrap"><div class="micro-bar" style="width:${pct}%;background:${MICRO_COLOR[key]}"></div></div>
          <div class="micro-val">${round1(t[key])}${units[key]} Â· ${Math.round(pct)}% DV</div>
        </div>`;
      }).join('')}
    </div>

    <div class="athlete-tip">${getTip(t)}</div>
  `;
}

// â”€â”€ Daily Goals â€” Cyclist Macro Calculator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//
// Science-based formulas for high endurance cyclists (per kg body weight/day):
//
//  Day type      | Carbs  | Protein | Fat   | Source
//  High Intensity| 9 g/kg | 1.8g/kg | 1.2g/kg | TrainerRoad, Jeukendrup, CTS
//  Regular       | 6 g/kg | 1.6g/kg | 1.0g/kg | Alpecin, InTheKnow Cycling
//  Recovery      | 4 g/kg | 1.8g/kg | 0.9g/kg | TrainerRoad rest day guidance
//
// Calories = (carbs Ã— 4) + (protein Ã— 4) + (fat Ã— 9)

let weightUnit = 'kg';
let selectedDayType = null;
let customIngredients = {};
let mixtures = {};

const DAY_FORMULAS = {
  high:     { carbsPerKg: 9,   proteinPerKg: 1.8, fatPerKg: 1.2,
              label: 'High Intensity', note: 'Carbs 9g/kg Â· Protein 1.8g/kg Â· Fat 1.2g/kg â€” optimised for hard rides & races.' },
  regular:  { carbsPerKg: 6,   proteinPerKg: 1.6, fatPerKg: 1.0,
              label: 'Regular Training', note: 'Carbs 6g/kg Â· Protein 1.6g/kg Â· Fat 1.0g/kg â€” steady endurance training day.' },
  recovery: { carbsPerKg: 4,   proteinPerKg: 1.8, fatPerKg: 0.9,
              label: 'Recovery Day', note: 'Carbs 4g/kg Â· Protein 1.8g/kg Â· Fat 0.9g/kg â€” reduced carbs, kept protein high for muscle repair.' },
};

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadCustomIngredients();
loadMixtures();
loadMeal();
renderMeal();
renderResults();
restoreWeight();
// Show today's date in the log panel
document.getElementById('logDateLabel').textContent =
  new Date().toLocaleDateString(undefined, { weekday:'long', month:'long', day:'numeric' });

function getWeightKg() {
  const raw = parseFloat(document.getElementById('bodyWeight').value);
  if (!raw || raw <= 0) return null;
  return weightUnit === 'lbs' ? raw / 2.20462 : raw;
}

function setWeightUnit(unit) {
  const currentKg = getWeightKg();
  weightUnit = unit;
  document.getElementById('btnKg').classList.toggle('active', unit === 'kg');
  document.getElementById('btnLbs').classList.toggle('active', unit === 'lbs');
  // Convert displayed value
  if (currentKg) {
    const input = document.getElementById('bodyWeight');
    input.value = unit === 'lbs' ? Math.round(currentKg * 2.20462) : Math.round(currentKg * 10) / 10;
  }
  localStorage.setItem('vegfuel_weightUnit', unit);
  onWeightOrDayChange();
}

function selectDayType(type) {
  selectedDayType = type;
  ['high','regular','recovery'].forEach(t => {
    document.getElementById('day' + t.charAt(0).toUpperCase() + t.slice(1))
      .classList.toggle('selected', t === type);
  });
  onWeightOrDayChange();
}

function onWeightOrDayChange() {
  const kg = getWeightKg();
  // Save weight to localStorage whenever it changes
  const rawVal = document.getElementById('bodyWeight').value;
  if (rawVal) localStorage.setItem('vegfuel_weight', rawVal);
  // Save day type selection keyed to today's date
  if (selectedDayType) localStorage.setItem('vegfuel_daytype_' + todayKey(), selectedDayType);
  if (!kg || !selectedDayType) {
    updateGoalsSubtitle();
    return;
  }
  const f = DAY_FORMULAS[selectedDayType];
  const carbs   = Math.round(f.carbsPerKg   * kg);
  const protein = Math.round(f.proteinPerKg * kg);
  const fat     = Math.round(f.fatPerKg     * kg);
  const cal     = Math.round(carbs * 4 + protein * 4 + fat * 9);

  document.getElementById('goalCal').value     = cal;
  document.getElementById('goalProtein').value = protein;
  document.getElementById('goalCarbs').value   = carbs;
  document.getElementById('goalFat').value     = fat;
  document.getElementById('goalsFormulaNote').textContent = f.note;

  updateGoalsSubtitle();
  renderResults();
}

function getGoals() {
  return {
    cal:     parseFloat(document.getElementById('goalCal').value)     || 0,
    protein: parseFloat(document.getElementById('goalProtein').value) || 0,
    carbs:   parseFloat(document.getElementById('goalCarbs').value)   || 0,
    fat:     parseFloat(document.getElementById('goalFat').value)     || 0,
  };
}

function onGoalChange() {
  // User manually edited â€” clear day type selection to avoid confusion
  ['high','regular','recovery'].forEach(t => {
    document.getElementById('day' + t.charAt(0).toUpperCase() + t.slice(1)).classList.remove('selected');
  });
  selectedDayType = null;
  document.getElementById('goalsFormulaNote').textContent = '';
  updateGoalsSubtitle();
  renderResults();
}

function updateGoalsSubtitle() {
  const g = getGoals();
  const sub = document.getElementById('goalsSubtitle');
  if (selectedDayType && getWeightKg()) {
    const kg = getWeightKg();
    const wStr = weightUnit === 'lbs'
      ? `${document.getElementById('bodyWeight').value} lbs`
      : `${Math.round(kg * 10) / 10} kg`;
    sub.textContent = `${DAY_FORMULAS[selectedDayType].label} Â· ${wStr} Â· ${g.cal} kcal`;
  } else if (g.cal || g.protein) {
    const parts = [];
    if (g.cal)     parts.push(`${g.cal} kcal`);
    if (g.protein) parts.push(`${g.protein}g protein`);
    sub.textContent = parts.join(' Â· ');
  } else {
    sub.textContent = 'enter weight & select day type';
  }
}

function toggleGoals() {
  const body = document.getElementById('goalsBody');
  const icon = document.getElementById('goalsToggleIcon');
  const open = body.classList.toggle('open');
  icon.classList.toggle('open', open);
}

function restoreWeight() {
  const savedUnit   = localStorage.getItem('vegfuel_weightUnit');
  const savedWeight = localStorage.getItem('vegfuel_weight');
  if (savedUnit && savedUnit !== weightUnit) {
    weightUnit = savedUnit;
    document.getElementById('btnKg').classList.toggle('active', savedUnit === 'kg');
    document.getElementById('btnLbs').classList.toggle('active', savedUnit === 'lbs');
  }
  if (savedWeight) {
    document.getElementById('bodyWeight').value = savedWeight;
  }
  // Restore today's day type selection (if any), clean up old day type keys
  const todayDayKey = 'vegfuel_daytype_' + todayKey();
  const savedDayType = localStorage.getItem(todayDayKey);
  Object.keys(localStorage).forEach(k => {
    if (k.startsWith('vegfuel_daytype_') && k !== todayDayKey) localStorage.removeItem(k);
  });
  if (savedDayType && DAY_FORMULAS[savedDayType]) {
    selectDayType(savedDayType);
  } else {
    updateGoalsSubtitle();
  }
}

// â”€â”€ Custom ingredients â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadCustomIngredients() {
  try {
    const saved = localStorage.getItem('vegfuel_custom_ingredients');
    if (saved) customIngredients = JSON.parse(saved);
  } catch(e) { customIngredients = {}; }
  // Merge into DB so they work with the regular search flow
  Object.assign(DB, customIngredients);
  // Add to datalist
  const dl = document.getElementById('ingredientSuggestions');
  Object.keys(customIngredients).forEach(name => {
    if (![...dl.options].some(o => o.value === name)) {
      const opt = document.createElement('option'); opt.value = name; dl.appendChild(opt);
    }
  });
  renderSavedCustoms();
}

function saveCustomIngredients() {
  localStorage.setItem('vegfuel_custom_ingredients', JSON.stringify(customIngredients));
}

function toggleCustomForm() {
  const form = document.getElementById('cifForm');
  const icon = document.getElementById('cifToggleIcon');
  const open = form.classList.toggle('open');
  icon.classList.toggle('open', open);
}

function clearCifForm() {
  ['cifName','cifCal','cifProtein','cifCarbs','cifFat','cifFiber',
   'cifIron','cifCalcium','cifPotassium','cifVitC','cifVitB12','cifZinc','cifMagnesium']
    .forEach(id => document.getElementById(id).value = '');
}

function cifVal(id) {
  return parseFloat(document.getElementById(id).value) || 0;
}

function saveCustomIngredient() {
  const name = document.getElementById('cifName').value.trim().toLowerCase();
  if (!name) return alert('Please enter an ingredient name.');
  if (!document.getElementById('cifCal').value) return alert('Please enter at least the calorie value.');

  const entry = {
    cal: cifVal('cifCal'), protein: cifVal('cifProtein'), carbs: cifVal('cifCarbs'),
    fat: cifVal('cifFat'), fiber: cifVal('cifFiber'), iron: cifVal('cifIron'),
    calcium: cifVal('cifCalcium'), potassium: cifVal('cifPotassium'), vitC: cifVal('cifVitC'),
    vitB12: cifVal('cifVitB12'), zinc: cifVal('cifZinc'), magnesium: cifVal('cifMagnesium'),
    _custom: true,
  };

  DB[name] = entry;
  customIngredients[name] = entry;
  saveCustomIngredients();

  // Add to datalist
  const dl = document.getElementById('ingredientSuggestions');
  if (![...dl.options].some(o => o.value === name)) {
    const opt = document.createElement('option'); opt.value = name; dl.appendChild(opt);
  }

  // Immediately add to today's log
  const rawAmount = parseFloat(document.getElementById('customAmount').value) || 100;
  const unit = document.getElementById('customUnit').value;
  meal.push({ name, amount: toGrams(rawAmount, unit), displayAmount: rawAmount, unit });
  recentlyUsed = [name, ...recentlyUsed.filter(n => n !== name)].slice(0, 15);
  saveMeal(); renderRecentChips(); renderMeal(); renderResults();
  renderSavedCustoms();
  clearCifForm();
}

function deleteCustomIngredient(name) {
  if (!confirm(`Delete "${name}" from saved custom ingredients?`)) return;
  delete customIngredients[name];
  delete DB[name];
  saveCustomIngredients();
  const dl = document.getElementById('ingredientSuggestions');
  const opt = [...dl.options].find(o => o.value === name);
  if (opt) opt.remove();
  renderSavedCustoms();
}

function addCustomToLog(name) {
  const rawAmount = parseFloat(document.getElementById('customAmount').value) || 100;
  const unit = document.getElementById('customUnit').value;
  meal.push({ name, amount: toGrams(rawAmount, unit), displayAmount: rawAmount, unit });
  recentlyUsed = [name, ...recentlyUsed.filter(n => n !== name)].slice(0, 15);
  saveMeal(); renderRecentChips(); renderMeal(); renderResults();
}

function renderSavedCustoms() {
  const section = document.getElementById('savedCustomsSection');
  const list = document.getElementById('savedCustomsList');
  const names = Object.keys(customIngredients);
  if (!names.length) { section.style.display = 'none'; return; }
  section.style.display = 'block';
  list.innerHTML = names.map(name => {
    const d = customIngredients[name];
    const esc = name.replace(/'/g, "\\'");
    return `<div class="saved-custom-item">
      <div>
        <div class="sci-name">${name}</div>
        <div class="sci-macros">${d.cal} kcal Â· ${d.protein}g pro Â· ${d.carbs}g carbs Â· ${d.fat}g fat <span style="color:var(--muted)">/100g</span></div>
      </div>
      <div class="sci-actions">
        <button class="sci-btn" onclick="addCustomToLog('${esc}')">+ add</button>
        <button class="sci-btn del" onclick="deleteCustomIngredient('${esc}')">âœ•</button>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€ Mixtures â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// mixtures: name â†’ { ingredients:[{name,amount}], yieldG, per100g:{...} }
let mixBuilderItems = []; // current builder ingredient list
let editingMixture = null; // name of mixture being edited, or null

function loadMixtures() {
  try {
    const saved = localStorage.getItem('vegfuel_mixtures');
    if (saved) mixtures = JSON.parse(saved);
  } catch(e) { mixtures = {}; }
  // Register each mixture in DB as a searchable ingredient
  Object.entries(mixtures).forEach(([name, mix]) => {
    DB[name] = { ...mix.per100g, _mixture: true };
    addMixToDatalist(name);
  });
  renderMixturesPanel();
}

function saveMixtures() {
  localStorage.setItem('vegfuel_mixtures', JSON.stringify(mixtures));
}

function addMixToDatalist(name) {
  const dl = document.getElementById('ingredientSuggestions');
  if (![...dl.options].some(o => o.value === name)) {
    const opt = document.createElement('option'); opt.value = name; dl.appendChild(opt);
  }
}

function toggleMixtures() {
  const body = document.getElementById('mixturesBody');
  const icon = document.getElementById('mixturesToggleIcon');
  const open = body.classList.toggle('open');
  icon.classList.toggle('open', open);
}

// â”€â”€ Builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addMixIngredient() {
  const name = document.getElementById('mixIngInput').value.trim().toLowerCase();
  const rawAmount = parseFloat(document.getElementById('mixIngAmount').value) || 100;
  const unit = document.getElementById('mixIngUnit').value;
  if (!name) return alert('Enter an ingredient name.');
  if (!DB[name]) return alert(`"${name}" not found in the database.`);
  if (DB[name]._mixture) return alert('Cannot nest a mixture inside another mixture.');
  mixBuilderItems.push({ name, amount: toGrams(rawAmount, unit), displayAmount: rawAmount, unit });
  document.getElementById('mixIngInput').value = '';
  renderMixBuilderList();
  renderMixPreview();
}

function removeMixBuilderItem(i) {
  mixBuilderItems.splice(i, 1);
  renderMixBuilderList();
  renderMixPreview();
}

function renderMixBuilderList() {
  const ul = document.getElementById('mixIngList');
  if (!mixBuilderItems.length) {
    ul.innerHTML = '<li style="font-size:0.78rem;color:var(--muted);padding:6px 0">No ingredients yet â€” add some above.</li>';
    return;
  }
  ul.innerHTML = mixBuilderItems.map((item, i) => `
    <li class="mix-ing-item">
      <span>${item.name}<span class="amount"> ${item.displayAmount}${item.unit}</span></span>
      <button class="remove-btn" onclick="removeMixBuilderItem(${i})">âœ•</button>
    </li>`).join('');
}

function computeMixTotals(items) {
  const keys = ['cal','protein','carbs','fat','fiber','iron','calcium','potassium','vitC','vitB12','zinc','magnesium'];
  const totals = Object.fromEntries(keys.map(k => [k, 0]));
  let totalGrams = 0;
  items.forEach(({ name, amount }) => {
    const d = DB[name]; if (!d) return;
    const mult = amount / 100;
    keys.forEach(k => totals[k] += (d[k] || 0) * mult);
    totalGrams += amount;
  });
  return { totals, totalGrams };
}

function renderMixPreview() {
  const preview = document.getElementById('mixPreview');
  const grid = document.getElementById('mixPreviewGrid');
  if (!mixBuilderItems.length) { preview.style.display = 'none'; return; }

  const { totals, totalGrams } = computeMixTotals(mixBuilderItems);
  const ingTotalEl = document.getElementById('mixIngTotal');
  if (ingTotalEl) ingTotalEl.textContent = Math.round(totalGrams) + 'g';
  const yieldRaw = parseFloat(document.getElementById('mixYield').value);
  const yieldUnit = document.getElementById('mixYieldUnit').value;
  const yieldG = yieldRaw ? (yieldUnit === 'oz' ? yieldRaw * 28.3495 : yieldRaw) : totalGrams;
  const scale = 100 / yieldG;
  const r = v => Math.round(v * scale * 10) / 10;

  preview.style.display = 'block';
  const yieldLabel = yieldRaw
    ? `per 100g of mixture (batch: ${yieldRaw}${yieldUnit})`
    : `per 100g of mixture (batch: ${Math.round(totalGrams)}g)`;
  preview.querySelector('.mix-preview-title').textContent = 'Nutrition ' + yieldLabel;

  grid.innerHTML = [
    { val: Math.round(totals.cal * scale), lbl: 'Calories', color: 'var(--orange)' },
    { val: r(totals.protein) + 'g', lbl: 'Protein', color: 'var(--green)' },
    { val: r(totals.carbs) + 'g',   lbl: 'Carbs',   color: 'var(--blue)' },
    { val: r(totals.fat) + 'g',     lbl: 'Fat',     color: 'var(--purple)' },
  ].map(({ val, lbl, color }) => `
    <div class="mix-preview-cell">
      <div class="mix-preview-val" style="color:${color}">${val}</div>
      <div class="mix-preview-lbl">${lbl}</div>
    </div>`).join('');
}

function clearMixBuilder() {
  mixBuilderItems = [];
  editingMixture = null;
  document.getElementById('mixName').value = '';
  document.getElementById('mixYield').value = '';
  document.getElementById('builderTitle').textContent = 'âœ¦ New Mixture';
  document.getElementById('mixCancelBtn').style.display = 'none';
  renderMixBuilderList();
  renderMixPreview();
}

function cancelMixEdit() { clearMixBuilder(); }

function saveMixture() {
  const name = document.getElementById('mixName').value.trim().toLowerCase();
  if (!name) return alert('Please give your mixture a name.');
  if (!mixBuilderItems.length) return alert('Add at least one ingredient.');

  const { totals, totalGrams } = computeMixTotals(mixBuilderItems);
  const yieldRaw = parseFloat(document.getElementById('mixYield').value);
  const yieldUnit = document.getElementById('mixYieldUnit').value;
  const yieldG = yieldRaw ? (yieldUnit === 'oz' ? yieldRaw * 28.3495 : yieldRaw) : totalGrams;
  const scale = 100 / yieldG;

  const keys = ['cal','protein','carbs','fat','fiber','iron','calcium','potassium','vitC','vitB12','zinc','magnesium'];
  const per100g = Object.fromEntries(keys.map(k => [k, Math.round((totals[k] || 0) * scale * 10) / 10]));
  per100g.cal = Math.round(totals.cal * scale);

  // If editing, remove old entry from DB/datalist first
  if (editingMixture && editingMixture !== name) {
    delete mixtures[editingMixture];
    delete DB[editingMixture];
    const dl = document.getElementById('ingredientSuggestions');
    const opt = [...dl.options].find(o => o.value === editingMixture);
    if (opt) opt.remove();
  }

  mixtures[name] = {
    ingredients: mixBuilderItems.map(i => ({ ...i })),
    yieldG,
    yieldUnit: document.getElementById('mixYieldUnit').value,
    per100g,
  };
  DB[name] = { ...per100g, _mixture: true };
  addMixToDatalist(name);
  saveMixtures();
  renderMixturesPanel();
  clearMixBuilder();
}

function editMixture(name) {
  const mix = mixtures[name];
  if (!mix) return;
  editingMixture = name;
  mixBuilderItems = mix.ingredients.map(i => ({ ...i }));
  document.getElementById('mixName').value = name;
  const storedUnit = mix.yieldUnit || 'g';
  document.getElementById('mixYieldUnit').value = storedUnit;
  const displayYield = storedUnit === 'oz'
    ? Math.round(mix.yieldG / 28.3495 * 10) / 10
    : Math.round(mix.yieldG);
  document.getElementById('mixYield').value = displayYield;
  document.getElementById('builderTitle').textContent = `âœ¦ Editing: ${name}`;
  document.getElementById('mixCancelBtn').style.display = 'inline-flex';
  renderMixBuilderList();
  renderMixPreview();
  // Scroll builder into view
  document.getElementById('mixtureBuilder').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function deleteMixture(name) {
  if (!confirm(`Delete mixture "${name}"?`)) return;
  delete mixtures[name];
  delete DB[name];
  saveMixtures();
  const dl = document.getElementById('ingredientSuggestions');
  const opt = [...dl.options].find(o => o.value === name);
  if (opt) opt.remove();
  renderMixturesPanel();
}

function addMixtureToLog(name) {
  if (!DB[name]) return;
  const rawAmount = 100;
  meal.push({ name, amount: 100, displayAmount: rawAmount, unit: 'g' });
  recentlyUsed = [name, ...recentlyUsed.filter(n => n !== name)].slice(0, 15);
  saveMeal(); renderRecentChips(); renderMeal(); renderResults();
}

function renderMixturesPanel() {
  const names = Object.keys(mixtures);
  const quickAdd = document.getElementById('mixturesQuickAdd');
  const chips = document.getElementById('mixturesChips');
  const cardsList = document.getElementById('mixtureCardsList');
  const subtitle = document.getElementById('mixturesSubtitle');

  subtitle.textContent = names.length
    ? `${names.length} saved mixture${names.length > 1 ? 's' : ''}`
    : 'salads, nut mixes, batch recipes';

  if (!names.length) { quickAdd.style.display = 'none'; return; }
  quickAdd.style.display = 'block';

  // Quick-add chips
  chips.innerHTML = names.map(name => {
    const esc = name.replace(/'/g, "\\'");
    return `<div class="preset-chip" onclick="addMixtureToLog('${esc}')">${name}</div>`;
  }).join('');

  // Full cards
  cardsList.innerHTML = names.map(name => {
    const mix = mixtures[name];
    const p = mix.per100g;
    const esc = name.replace(/'/g, "\\'");
    const ingredientSummary = mix.ingredients.slice(0, 4).map(i => i.name).join(', ')
      + (mix.ingredients.length > 4 ? ` +${mix.ingredients.length - 4} more` : '');
    return `<div class="mixture-card">
      <div class="mixture-card-header">
        <div>
          <div class="mixture-card-name">${name}</div>
          <div class="mixture-card-meta">${ingredientSummary} Â· batch: ${Math.round(mix.yieldG)}g</div>
        </div>
      </div>
      <div class="mixture-card-macros">
        <span class="mixture-macro-chip" style="color:var(--orange)">${Math.round(p.cal * mix.yieldG / 100)} kcal</span>
        <span class="mixture-macro-chip" style="color:var(--green)">${Math.round(p.protein * mix.yieldG / 100)}g protein</span>
        <span class="mixture-macro-chip" style="color:var(--blue)">${Math.round(p.carbs * mix.yieldG / 100)}g carbs</span>
        <span class="mixture-macro-chip" style="color:var(--purple)">${Math.round(p.fat * mix.yieldG / 100)}g fat</span>
        <span style="font-size:0.65rem;color:var(--muted);align-self:center">total batch</span>
      </div>
      <div class="mixture-card-actions">
        <div class="mixture-add-row">
          <input type="number" id="mixAmt_${name.replace(/\s/g,'_')}" value="100" min="1" step="1">
          <select id="mixUnit_${name.replace(/\s/g,'_')}">
            <option value="g">g</option>
            <option value="oz">oz</option>
          </select>
        </div>
        <button class="mix-btn" onclick="logMixtureAmount('${esc}')">+ Log</button>
        <button class="mix-btn edit-btn" onclick="editMixture('${esc}')">Edit</button>
        <button class="mix-btn ghost" onclick="deleteMixture('${esc}')">âœ•</button>
      </div>
    </div>`;
  }).join('');
}

function logMixtureAmount(name) {
  const safeName = name.replace(/\s/g, '_');
  const rawAmount = parseFloat(document.getElementById('mixAmt_' + safeName).value) || 100;
  const unit = document.getElementById('mixUnit_' + safeName).value;
  const amount = unit === 'oz' ? rawAmount * 28.3495 : rawAmount;
  meal.push({ name, amount, displayAmount: rawAmount, unit });
  recentlyUsed = [name, ...recentlyUsed.filter(n => n !== name)].slice(0, 15);
  saveMeal(); renderRecentChips(); renderMeal(); renderResults();
}
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/vegfuel/sw.js', {scope: '/vegfuel/'}).catch(() => {});
  });
}
</script>


</body></html>
